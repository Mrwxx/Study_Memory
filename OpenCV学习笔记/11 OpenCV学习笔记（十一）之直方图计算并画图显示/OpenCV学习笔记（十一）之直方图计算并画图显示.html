<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenCV学习笔记（十一）之直方图计算并画图显示</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h2><a id="_0"></a>本文章由公号【开发小鸽】发布！欢迎关注！！！</h2>
<br>
<p><strong>老规矩–妹妹镇楼：</strong></p>
<center>
<img src="https://img-blog.csdnimg.cn/20200721223424816.JPG" width="20%">
</center><h2><a id="__8"></a>一. 直方图</h2>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;对于图像梯度，每个像素的角度，等图像的属性都可以建立直方图。</p>
<h2><a id="__10"></a>二. 直方图的常见属性：</h2>
<ol>
<li><strong>dims</strong>-表示维度</li>
<li><strong>bins</strong>-表示维度中子区域大小划分,bins=256,表示划分为256个级别</li>
<li><strong>range</strong>-表示值的范围，灰度值范围为[0,255]</li>
</ol>
<h2><a id="_API__15"></a>三. API 分析</h2>
<ol>
<li><strong>cv::split ()把多通道图像分为多个单通道图像</strong></li>
</ol>
<pre><code class="prism language-cpp"><span class="token function">split</span><span class="token punctuation">(</span>			
	<span class="token keyword">const</span> Mat <span class="token operator">&amp;</span> src<span class="token punctuation">,</span>			<span class="token comment">//输入图像</span>
	Mat<span class="token operator">*</span> mvbegin				<span class="token comment">//输出的通道图像数组</span>
）
</code></pre>
<ol start="2">
<li><strong>cv::calcHist()生成直方图数据</strong></li>
</ol>
<pre><code class="prism language-cpp"><span class="token function">calcHist</span><span class="token punctuation">(</span>
	<span class="token keyword">const</span> Mat<span class="token operator">*</span> images<span class="token punctuation">,</span>		<span class="token comment">//输入图像指针</span>
	<span class="token keyword">int</span> nimages<span class="token punctuation">,</span>					<span class="token comment">//图像数目</span>
	<span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> channels<span class="token punctuation">,</span>		<span class="token comment">//通道数</span>
	InputArray mask<span class="token punctuation">,</span>			<span class="token comment">//掩膜</span>
	OutputArray hist<span class="token punctuation">,</span>			<span class="token comment">//直方图数据</span>
	<span class="token keyword">int</span> dims<span class="token punctuation">,</span>						<span class="token comment">//维数</span>
	<span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">*</span> histSize<span class="token punctuation">,</span>		<span class="token comment">//直方图级数</span>
	<span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">*</span> ranges<span class="token punctuation">,</span>		<span class="token comment">//值域范围</span>
	<span class="token keyword">bool</span> uniform<span class="token punctuation">,</span>				
	<span class="token keyword">bool</span> accumulate
<span class="token punctuation">)</span>
</code></pre>
<h2><a id="__41"></a>四. <strong>代码实现</strong></h2>
<pre><code class="prism language-cpp"><span class="token comment">/*****直方图计算*****/</span>

<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;vector&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	cv<span class="token operator">::</span>Mat src<span class="token punctuation">,</span> dst<span class="token punctuation">;</span>
	src <span class="token operator">=</span> cv<span class="token operator">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"1.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token operator">::</span><span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"in"</span><span class="token punctuation">,</span> cv<span class="token operator">::</span>WINDOW_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token operator">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"in"</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//将多通道图像分为单通道图像</span>
	<span class="token comment">//单通道图像vector</span>
	vector<span class="token operator">&lt;</span>cv<span class="token operator">::</span>Mat<span class="token operator">&gt;</span>  bgr_planes<span class="token punctuation">;</span>
	cv<span class="token operator">::</span><span class="token function">split</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> bgr_planes<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//直方图参数</span>
	<span class="token keyword">int</span> histSize <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> range<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">*</span> histRanges <span class="token operator">=</span> <span class="token punctuation">{</span> range <span class="token punctuation">}</span><span class="token punctuation">;</span>
	cv<span class="token operator">::</span>Mat b_hist<span class="token punctuation">,</span> g_hist<span class="token punctuation">,</span> r_hist<span class="token punctuation">;</span>
	<span class="token comment">//求出直方图的数据</span>
	cv<span class="token operator">::</span><span class="token function">calcHist</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>bgr_planes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> b_hist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>histSize<span class="token punctuation">,</span>
		<span class="token operator">&amp;</span>histRanges<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token operator">::</span><span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>bgr_planes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> g_hist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>histSize<span class="token punctuation">,</span>
		<span class="token operator">&amp;</span>histRanges<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token operator">::</span><span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>bgr_planes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r_hist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>histSize<span class="token punctuation">,</span>
		<span class="token operator">&amp;</span>histRanges<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//画出直方图</span>
	<span class="token keyword">int</span> hist_h <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> hist_w <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> bin_w <span class="token operator">=</span> hist_w <span class="token operator">/</span> histSize<span class="token punctuation">;</span>		<span class="token comment">//直方图的步数</span>
	cv<span class="token operator">::</span>Mat <span class="token function">hist_image</span><span class="token punctuation">(</span>hist_w<span class="token punctuation">,</span> hist_h<span class="token punctuation">,</span> CV_8UC3<span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//将数据归一化到直方图的图像尺寸中来</span>
	cv<span class="token operator">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>b_hist<span class="token punctuation">,</span> b_hist<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> hist_h<span class="token punctuation">,</span> cv<span class="token operator">::</span>NORM_MINMAX<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token operator">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>g_hist<span class="token punctuation">,</span> g_hist<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> hist_h<span class="token punctuation">,</span> cv<span class="token operator">::</span>NORM_MINMAX<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token operator">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>r_hist<span class="token punctuation">,</span> r_hist<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> hist_h<span class="token punctuation">,</span> cv<span class="token operator">::</span>NORM_MINMAX<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Mat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//0-255 的像素值，画出每个像素值的连线</span>
	<span class="token comment">//注意： 图像中的坐标是以左上角为原点向右下方延伸</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span>histSize<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		cv<span class="token operator">::</span><span class="token function">line</span><span class="token punctuation">(</span>hist_image<span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bin_w<span class="token punctuation">,</span> hist_h <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>b_hist<span class="token punctuation">.</span>at<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span>i <span class="token operator">*</span> bin_w<span class="token punctuation">,</span> hist_h <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>b_hist<span class="token punctuation">.</span>at<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> cv<span class="token operator">::</span>LINE_AA<span class="token punctuation">)</span><span class="token punctuation">;</span>
		cv<span class="token operator">::</span><span class="token function">line</span><span class="token punctuation">(</span>hist_image<span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bin_w<span class="token punctuation">,</span> hist_h <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>g_hist<span class="token punctuation">.</span>at<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span>i <span class="token operator">*</span> bin_w<span class="token punctuation">,</span> hist_h <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>g_hist<span class="token punctuation">.</span>at<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> cv<span class="token operator">::</span>LINE_AA<span class="token punctuation">)</span><span class="token punctuation">;</span>
		cv<span class="token operator">::</span><span class="token function">line</span><span class="token punctuation">(</span>hist_image<span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bin_w<span class="token punctuation">,</span> hist_h <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>r_hist<span class="token punctuation">.</span>at<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span>i <span class="token operator">*</span> bin_w<span class="token punctuation">,</span> hist_h <span class="token operator">-</span> <span class="token function">cvRound</span><span class="token punctuation">(</span>r_hist<span class="token punctuation">.</span>at<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> cv<span class="token operator">::</span>LINE_AA<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	cv<span class="token operator">::</span><span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"ou"</span><span class="token punctuation">,</span> cv<span class="token operator">::</span>WINDOW_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cv<span class="token operator">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"ou"</span><span class="token punctuation">,</span> hist_image<span class="token punctuation">)</span><span class="token punctuation">;</span>

	cv<span class="token operator">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
</body>

</html>
