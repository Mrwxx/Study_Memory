<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>【Java学习笔记（五十一）】之MyBatis多表查询，MyBatis注解开发</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h2><a id="_0"></a>本文章由公号【开发小鸽】发布！欢迎关注！！！</h2>
<br>
<p><strong>老规矩–妹妹镇楼：</strong></p>
<center>
<img src="https://img-blog.csdnimg.cn/20200721223424816.JPG" width="20%">
</center><h2><a id="%09MyBatis_7"></a>一．	MyBatis多表查询</h2>
<h3><a id="%09_8"></a>（一）	一对一查询</h3>
<h4><a id="1%09_9"></a>1.	数据表的关系</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 用户表和订单表的关系为，一个用户有多个订单，但是一个订单只从属于一个用户。因此从订单的角度来看，订单与用户的关系是一对一的关系。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 一对一查询的需求：查询一个订单，与此同时查询出该订单所属的用户。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 数据库中表和表的关系是通过主外键进行关联的，如一对一的关系中，要么是两个表拥有相同的主键；要么是一个表用外键，这个外键是另一个表的主键。<br>
<br></p>
<h4><a id="2%09_18"></a>2.	用户表和订单表的实例</h4>
<h5><a id="1%09_19"></a>（1）	用户表和订单表的设计</h5>
<p>用户表：</p>
<pre><code class="prism language-cpp">id：用户的id
username：用户名
password<span class="token operator">:</span>密码
</code></pre>
<p>订单表：</p>
<pre><code class="prism language-cpp">id：订单的id，主键
ordertime<span class="token operator">:</span>订单时间
total<span class="token operator">:</span>金额
uid<span class="token operator">:</span>外键，对应用户表的主键id
</code></pre>
<br>
<h5><a id="2%09Java_40"></a>（2）	Java中实现两表的连接</h5>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 数据库中订单表直接使用uid作为外键，对应用户表的主键id，以此来连接两个表。但是在Java中，订单对象Order中若只是存储uid这些数字是没法连接用户对象User的。我们需要在Order对象中引用User对象，即把User对象作为Order对象的属性，这样才能连接两个对象。<br>
<br></p>
<h5><a id="3%09_46"></a>（3）	配置映射文件</h5>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 数据库中可以直接用SQL语句同时查询两个表，而Java中可是不能直接查询的，一切都是与对象联系起来的，若查询出来的数据对应的对象进行封装，是无法使用的。因此，我们需要配置对象的关系，将两个对象联系起来。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 由于SQL语句写在映射文件中，因此我们需要在映射文件中进行配置。如两表同时查询出来的数据是无法用Order对象进行封装的，需要对Order对象进行配置。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 这里使用的是一个新的标签resultMap，用于手动指定数据表的字段和实体对象的属性的映射关系。id属性是名称，type属性是实体对象的全限定名。</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>”orderMap”</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>”order”</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 在其中可以添加子标签id，用于映射数据库的主键和实体对象属性的关系，</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 如：Order表的主键oid字段与Order对象的id属性对应</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”oid”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”id”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 如：其他的数据表普通字段使用result标签</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”ordertime”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”ordertime”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 而到了Order对象中的User对象时，我们要怎么映射呢？</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 同样是将数据表的字段映射到实体对象的属性中，只不过这次要映射到User对象的属性中了。<br>
如，将数据表中的username字段映射到User对象的username属性中，注意property属性的写法，user.username代表着Order对象中的user属性对象中的username属性：</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”username”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”user.username”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 整体的resultMap如下所示：</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>”orderMap”</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>”order”</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”oid”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”id”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”ordertime”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”ordertime”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”total”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”total”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”uid”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”user,id”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”username”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”user.username”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”password”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”user.password”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 最后将配置好的resultMap放到sql语句的标签属性resultMap中：</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>”findAll”</span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span>”orderMap”</span><span class="token punctuation">&gt;</span></span>
	SELECT *,o.id oid FROM order o, user u, where o.uid=u.id
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<br>
<h5><a id="4%09User_104"></a>（4）	配置User对象的优化</h5>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 我们可以优化User对象的配置，用association标签，property属性表示要配置的User对象在Order实体中的属性名称，javaType属性表示该user属性的全限定名。</p>
<p>如：</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”user”</span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span>”user”</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 其中可以添加子标签id,result，方法与上面差不多，唯一的差别是property属性中不需要再添加user了，直接用User对象中的属性名即可：</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”user”</span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation">=</span>”user”</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”uid”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”id”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”username”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”username”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”password”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”password”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<br>
<h3><a id="%09_126"></a>（二）	一对多查询的模型</h3>
<h4><a id="1%09_127"></a>1.	一对多关系</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 从用户的角度来看，一个用户可以有多个订单。因此一对多查询的需求：查询一个用户，于此同时查询出该用户具有的订单。<br>
<br></p>
<h4><a id="2%09_133"></a>2.	数据表的设计</h4>
<p>用户表：</p>
<pre><code class="prism language-xml">id:用户id，主键
username:用户名
password:密码
</code></pre>
<p>订单表：</p>
<pre><code class="prism language-xml">id:订单id，主键
ordertime:订单时间
total:金额
uid:订单所属用户id，外键
</code></pre>
<br>
<h4><a id="3%09Java_154"></a>3.	Java中实现一对多</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 一个用户可以有多个订单，数据表中可以直接用订单表的uid外键与用户表相关联，但是Java中使用对象来链接的，因此需要在User对象中引用Order对象，将Order对象的集合作为User对象的一个属性使用，即可表示一个User对象可以有多个Order对象：</p>
<pre><code class="prism language-java"><span class="token keyword">private</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>Order<span class="token punctuation">&gt;</span></span> orderList<span class="token punctuation">;</span>
</code></pre>
<br>
<h4><a id="4%09_164"></a>4.	配置映射文件</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 同理，我们通过查询User用户表以及其中引用的Order订单表，是无法直接封装到任何一个对象上的，需要手动配置映射文件，将数据表中的每一项和User对象，Order对象的属性分别对应起来。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 设置resultMap标签，配置User对象，方法都是相同的。</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>”userMap”</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>”user”</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”uid”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”id”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
	……
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 只不过User对象中有Order对象的集合属性，需要使用collection标签来配置。property属性为User对象中的Order对象的集合属性名称，ofType属性为集合中的对象类型的全限定名。其中可以添加子标签，表示Order对象的属性。</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”orderList”</span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span>”order”</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”oid”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”id”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
	……
</code></pre>
<br>
<h3><a id="%09_186"></a>（三）	多对多查询</h3>
<h4><a id="1%09_187"></a>1.	多对多查询的模型</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 用户表和角色表的关系：一个用户有多个角色，一个角色被多个用户使用，这就是多对多的关系。现在的需求是：查询用户的同时查询出该用户的所有角色。多对多的查询需要使用中间表，存储两个表的主键的映射关系，如要查询用户，则查询用户表的主键ID对应的角色表的ID即可。<br>
<br></p>
<h4><a id="2%09_193"></a>2.	数据表的设计</h4>
<p>用户表：</p>
<pre><code class="prism language-xml">id:用户id，主键
username:用户名
password:密码
</code></pre>
<p>角色表：</p>
<pre><code class="prism language-xml">id:角色id，主键
roleName:角色名称
roleDesc:角色描述
</code></pre>
<p>中间表：</p>
<pre><code class="prism language-xml">userId:用户表的主键id
roleId:角色表的主键id
</code></pre>
<br>
<h4><a id="3%09Java_220"></a>3.	Java中实现多对多</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 一个用户可以有多个角色，我们要通过查询用户来查询用户有多少个角色，因此，在用户User对象中设置Role对象集合属性，表示该用户拥有的角色集合。</p>
<pre><code class="prism language-xml">private List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Role</span><span class="token punctuation">&gt;</span></span> roleList;
</code></pre>
<br>
<h4><a id="4%09_231"></a>4.	配置映射文件</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 在UserMapper接口添加了接口方法findUserAndRoleAll()方法后，需要配置这个方法的映射文件。其实，多对多查询在使用中单个查询，本质上还是一对多查询，只是多了个中间表而已，SQL语句不太一样，SQL语句中通过中间表将两个表映射起来。</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>”userRoleMap”</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>”user”</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”userId”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”id”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”username”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”username</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”password”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”password”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reseult</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”roleList”</span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation">=</span>”role”</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”roleId”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”id”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”roleName”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”roleName”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span>”roleDesc”</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span>”roleDesc”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>”findUserAndRoleAll”</span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span>”userRoleMap”</span><span class="token punctuation">&gt;</span></span>
		select * from user u, sys_user_role ur, sys_role r where u.id=ur.userId and ur.roleId=r.id
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<br>
<h2><a id="%09MyBatis_257"></a>二．	MyBatis的注解开发</h2>
<h3><a id="%09MyBatis_258"></a>（一）	MyBatis的常用注解</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; MyBatis可以使用注解开发的方式，这样可以减少编写Mapper映射文件了，直接在接口的方法上进行注解开发。下面是一些常用的注解：</p>
<h4><a id="1%09Insert_260"></a>1.	@Insert</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 实现插入数据</p>
<h4><a id="2%09Update_263"></a>2.	@Update</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 实现更新数据</p>
<h4><a id="3%09Delete_266"></a>3.	@Delete</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 实现删除数据</p>
<h4><a id="4%09Select_269"></a>4.	@Select</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 实现查询数据</p>
<h4><a id="5%09Result_272"></a>5.	@Result</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 实现结果集的封装</p>
<h4><a id="6%09Results_275"></a>6.	@Results</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 可以和@Result一起使用，封装多个结果集</p>
<h4><a id="7%09One_278"></a>7.	@One</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 实现一对一的结果集封装</p>
<h4><a id="8%09Many_281"></a>8.	@Many</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 实现一对多的结果集封装<br>
<br></p>
<h3><a id="%09CRUD_287"></a>（二）	注解完成基本的CRUD</h3>
<h4><a id="1%09_288"></a>1.	接口方法添加注解</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 注解是用于替代Mapper映射文件的，原有的Mapper映射文件中的SQL语句需要放到注解中，同时还有手动配置的数据库表的字段和实体对象的属性的映射关系，都要放到注解中。</p>
<p>如：</p>
<p>插入数据：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span>“insert into user <span class="token function">values</span><span class="token punctuation">(</span>#<span class="token punctuation">{</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span> #<span class="token punctuation">{</span>username<span class="token punctuation">}</span><span class="token punctuation">,</span> #<span class="token punctuation">{</span>password<span class="token punctuation">}</span><span class="token punctuation">)</span>”<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 可以看到，这里直接把SQL语句原封不动地写过来是可行的，因为接口方法的传入参数即是原来的映射文件中的parameterType，而返回类型即是resultType，因此，可以根据传入参数使用#{id}这种方式。<br>
<br></p>
<h4><a id="2%09_305"></a>2.	核心配置文件中加载映射关系</h4>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 由于没有了Mapper映射文件，核心配置文件中的加载映射文件也要删除，替换成加载映射关系。同样是使用mappers标签，添加子标签package，name属性为借口方法所在的包的全限定名。</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>”com.mybatis.mapper”</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>package</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<br>
<h3><a id="%09_317"></a>（三）	注解实现复杂映射开发</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 上面通过注解实现了简单的CRUD操作，那么下面我们要通过注解实现复杂的映射。</p>
<h4><a id="1%09_319"></a>1.	常用的注解</h4>
<h5><a id="1Results_320"></a>（1）@Results</h5>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 代替标签<code>&lt;resultMap&gt;</code>，该注解中可以使用单个@Result注解，也可以使用@Result集合。使用的格式：@Results({@Result(), @Result()})或者@Results(@Result())<br>
<br></p>
<h5><a id="2Result_326"></a>（2）@Result</h5>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 代替了<code>&lt;id&gt;</code>和<code>&lt;result&gt;</code>标签。@Result中的属性为：</p>
<pre><code class="prism language-xml">column:数据库的字段名

property:实体对象的属性名

one:需要使用的@One注解，用于一对一查询(@Result(one=@One)())

many:需要使用到@Many注解，用于一对多查询（@Result(many=@many)()）
</code></pre>
<br>
<h5><a id="3One_342"></a>（3）@One</h5>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 代替了<code>&lt;association&gt;</code>标签，用于指定子查询返回单一对象，用于一对一查询。</p>
<p>@One中的属性：</p>
<pre><code class="prism language-xml">select:指定用来查询的接口方法的全限定名
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 使用格式：@Result(column=””, property=””, one=@One(select=””))<br>
<br></p>
<h5><a id="4Many_356"></a>（4）@Many</h5>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 代替了<code>&lt;collection&gt;</code>标签，用于指定子查询返回对象集合。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 使用格式：@Result(property=””, column=””, many=@Many(select=””))<br>
<br></p>
<h4><a id="2%09_364"></a>2.	注解实现一对一查询</h4>
<h5><a id="1%09_365"></a>（1）	需求</h5>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 查询订单对应的唯一用户。<br>
<br></p>
<h5><a id="2%09_371"></a>（2）	实现</h5>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 因此，首先要在OrderMapper的接口中添加查询方法findAll()，继而添加注解@Select:</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span>“select <span class="token operator">*</span><span class="token punctuation">,</span>o<span class="token punctuation">.</span>id oid from orders o<span class="token punctuation">,</span>user u where o<span class="token punctuation">.</span>uid<span class="token operator">=</span>u<span class="token punctuation">.</span>id”<span class="token punctuation">)</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 因为是两个表的数据，需要手动映射查询出的数据表字段和实体对象的属性的映射关系。使用@Results注解，在其中添加@Result注解：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Results</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column<span class="token operator">=</span>”oid”<span class="token punctuation">,</span> property<span class="token operator">=</span>”id”<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column<span class="token operator">=</span>”ordertime”<span class="token punctuation">,</span> property<span class="token operator">=</span>”ordertime”<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column<span class="token operator">=</span>”total”<span class="token punctuation">,</span> property<span class="token operator">=</span>”total”<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column<span class="token operator">=</span>”uid”<span class="token punctuation">,</span> property<span class="token operator">=</span>”user<span class="token punctuation">.</span>id”<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column<span class="token operator">=</span>”username”<span class="token punctuation">,</span> property<span class="token operator">=</span>”user<span class="token punctuation">.</span>username”<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column<span class="token operator">=</span>”password”<span class="token punctuation">,</span> property<span class="token operator">=</span>”user<span class="token punctuation">.</span>password”<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<br>
<h5><a id="3%09_394"></a>（3）	优化</h5>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 我们可以将同时查询两个表分为一次查询一个表，第一次查询Order表，第二次将查询出的uid用来查询User表。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 因此，OrderMapper接口中的findAll方法的注解就要修改了。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 首先，第一个SQL语句为”select * from orders”，放在@Select中：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span>“select <span class="token operator">*</span> from orders”<span class="token punctuation">)</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; Order中的普通属性映射不变，需要变化的是Order属性中的User属性，我们需要用@One注解。</p>
<p>同样是@Result注解:</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; property属性为要封装的User对象在Order对象中的属性名称”user”，</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; javaType属性为要封装的实体对象字节码User.class，</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; column属性为我们要根据第一个SQL语句查询出的哪个字段名来进行第二个SQL语句的查询，这里是Order表中的uid字段,</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; one属性使用@One注解，select属性表示着第二个SQL语句的接口方法的全限定名。</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>
		property<span class="token operator">=</span>”user”<span class="token punctuation">,</span>
		column<span class="token operator">=</span>”uid”<span class="token punctuation">,</span>
		javaType<span class="token operator">=</span>User<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
		one<span class="token operator">=</span><span class="token annotation punctuation">@One</span><span class="token punctuation">(</span>select<span class="token operator">=</span>”com<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>UserMapper<span class="token punctuation">.</span>findById”<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 第二个SQL语句对应的方法为：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span>“select <span class="token operator">*</span> from user where id<span class="token operator">=</span>#<span class="token punctuation">{</span>id<span class="token punctuation">}</span>”<span class="token punctuation">)</span>
<span class="token keyword">public</span> User <span class="token function">findById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; id是将第一个SQL语句中查询出的Order表的uid字段作为参数传入的，SQL语句中也可以直接使用该id。<br>
<br></p>
<h4><a id="3%09_438"></a>3.	注解实现一对多查询</h4>
<h5><a id="1%09_439"></a>（1）	需求</h5>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 一个用户有多个订单，一个订单只从属于一个用户。因此查询一个用户，同时查询出该用户的所有订单。<br>
<br></p>
<h5><a id="2%09_445"></a>（2）	实现</h5>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 一个用户有多个订单，因此在User对象中添加Order对象集合属性orderList:</p>
<pre><code class="prism language-java"><span class="token keyword">private</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>Order<span class="token punctuation">&gt;</span></span> orderList<span class="token punctuation">;</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 接着，在UserMapper接口中添加方法findUserAndOrderAll()，并添加注解。这里直接使用上面优化的方法，将SQL语句分为两次执行。第一次查询User表：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span>“select <span class="token operator">*</span> from user”<span class="token punctuation">)</span>
<span class="token keyword">public</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> <span class="token function">findUserAndOrderAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 那么，查询了User表后，我们需要将uid值传入第二个SQL语句中。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 首先，第二个SQL语句是要查询Order表，因此在OrderMapper 接口中添加方法findByUid，传入参数uid：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span>“select <span class="token operator">*</span> from orders where uid<span class="token operator">=</span>#<span class="token punctuation">{</span>uid<span class="token punctuation">}</span>”<span class="token punctuation">)</span>
<span class="token keyword">public</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>Order<span class="token punctuation">&gt;</span></span> <span class="token function">findByUid</span><span class="token punctuation">(</span><span class="token keyword">int</span> uid<span class="token punctuation">)</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 接着，就可以配置UserMapper接口中的findUserAndOrderAll方法的注解了，大体的方法和一对一查询差不多，只不过将one属性和@One注解换成了many和@Many注解，同时javaType属性为List.class。</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>
	property<span class="token operator">=</span>”orderList”<span class="token punctuation">,</span>
	column<span class="token operator">=</span>”id”<span class="token punctuation">,</span>
	javaType<span class="token operator">=</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
	many<span class="token operator">=</span><span class="token annotation punctuation">@Many</span><span class="token punctuation">(</span>select<span class="token operator">=</span>”com<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>OrderMapper<span class="token punctuation">.</span>findByUid”<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre>
<br>
<h4><a id="4%09_482"></a>4.	注解实现多对多查询</h4>
<h5><a id="1%09_483"></a>（1）	需求</h5>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 一个用户有多个角色，一个角色被多个用户使用。查询用户的同时查询出该用户的所有角色。<br>
<br></p>
<h5><a id="2%09_489"></a>（2）	实现</h5>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 首先，在User对象中添加Role对象集合属性：</p>
<pre><code class="prism language-java"><span class="token keyword">private</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>Role<span class="token punctuation">&gt;</span></span> roleList<span class="token punctuation">;</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 接下来其实和一对多查询差不多，只是多了一个中间表。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 第一次SQL查询，查询User表，在UserMapper中的方法findUserAndRoleAll上添加注解：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span>“select <span class="token operator">*</span> from user<span class="token punctuation">)</span>
<span class="token keyword">public</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> <span class="token function">findUserAndRoleAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 接着是第二次SQL查询，查询Role表和中间表，根据第一次SQL查询出的uid进行第二次查询：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span>“select <span class="token operator">*</span> from sys_user_role ur<span class="token punctuation">,</span> sys_role r where ur<span class="token punctuation">.</span>roleId<span class="token operator">=</span>r<span class="token punctuation">.</span>id and ur<span class="token punctuation">.</span>userId<span class="token operator">=</span>#<span class="token punctuation">{</span>uid<span class="token punctuation">}</span>”<span class="token punctuation">)</span>
<span class="token keyword">public</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>Role<span class="token punctuation">&gt;</span></span> <span class="token function">findByUid</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp; 继而，就可以在第一次SQL查询中添加映射注解@Results了，方法同一对多查询：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span>“select <span class="token operator">*</span> from user”<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Results</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column<span class="token operator">=</span>”id”<span class="token punctuation">,</span> property<span class="token operator">=</span>”id”<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column<span class="token operator">=</span>”username”<span class="token punctuation">,</span> property<span class="token operator">=</span>”username”<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column<span class="token operator">=</span>”password”<span class="token punctuation">,</span> property<span class="token operator">=</span>”password”<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>
	property<span class="token operator">=</span>”roleList”<span class="token punctuation">,</span>
	column<span class="token operator">=</span>”id”<span class="token punctuation">,</span>
	javaType<span class="token operator">=</span>List<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
	many<span class="token operator">=</span><span class="token annotation punctuation">@Many</span><span class="token punctuation">(</span>select<span class="token operator">=</span>”com<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>RoleMapper<span class="token punctuation">.</span>findByUid”<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> <span class="token function">findUserAndRoleAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div>
</body>

</html>
