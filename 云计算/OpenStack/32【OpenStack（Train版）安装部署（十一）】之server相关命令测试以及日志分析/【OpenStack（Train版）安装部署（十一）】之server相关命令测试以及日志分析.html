<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>【OpenStack（Train版）安装部署（十一）】之server相关命令测试以及日志分析</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><p></p><div class="toc"><h3>文章目录</h3><ul><ul><li><a href="#_1">本文章由公号【开发小鸽】发布！欢迎关注！！！</a></li><li><a href="#1%09server_10">1.	server相关命令测试</a></li><ul><li><a href="#1server_12">（1）查看server相关命令</a></li><li><a href="#2server_add_fixed_ip_70">（2）server add fixed ip</a></li><li><a href="#3server_add_floating_ip_79">（3）server add floating ip</a></li><li><a href="#4server_add_network_89">（4）server add network</a></li><li><a href="#5server_add_port_99">（5）server add port</a></li><li><a href="#6server_add_security_group_108">（6）server add security group</a></li><li><a href="#7server_add_volume_119">（7）server add volume</a></li><li><a href="#8server_backup_create_128">（8）server backup create</a></li><li><a href="#9server_create_137">（9）server create</a></li><li><a href="#10server_delete_145">（10）server delete</a></li><li><a href="#11__server_dump_create_155">（11）  server dump create</a></li><li><a href="#12server_event_list_164">（12）server event list</a></li><li><a href="#13server_event_show_174">（13）server event show</a></li><li><a href="#14server_group_create_189">（14）server group create</a></li><li><a href="#15server_group_delete_198">（15）server group delete</a></li><li><a href="#16server_group_list_207">（16）server group list</a></li><li><a href="#17server_group_show_216">（17）server group show</a></li><li><a href="#18server_image_create_226">（18）server image create</a></li><li><a href="#19server_list_234">（19）server list</a></li><li><a href="#20server_lock_243">（20）server lock</a></li><li><a href="#21server_migrate_252">（21）server migrate</a></li><li><a href="#22server_pause_441">（22）server pause</a></li><li><a href="#23server_reboot_450">（23）server reboot</a></li><li><a href="#24server_rebuild_460">（24）server rebuild</a></li><li><a href="#25server_remove_fixed_ip_469">（25）server remove fixed ip</a></li><li><a href="#26server_remove_floating_ip_478">（26）server remove floating ip</a></li><li><a href="#27server_remove_network_486">（27）server remove network</a></li><li><a href="#28server_remove_port_495">（28）server remove port</a></li><li><a href="#29server_remove_security_group_504">（29）server remove security group</a></li><li><a href="#30server_remove_volume_513">（30）server remove volume</a></li><li><a href="#31server_rescue_521">（31）server rescue</a></li><li><a href="#32server_resize_530">（32）server resize</a></li><li><a href="#33server_resize_confirm_746">（33）server resize confirm</a></li><li><a href="#34server_resize_revert_754">（34）server resize revert</a></li><li><a href="#35server_restore_763">（35）server restore</a></li><li><a href="#36server_resume_772">（36）server resume</a></li><li><a href="#37server_set_780">（37）server set</a></li><li><a href="#38server_shelve_788">（38）server shelve</a></li><li><a href="#39server_show_797">（39）server show</a></li><li><a href="#40server_ssh_806">（40）server ssh</a></li><li><a href="#41server_start_814">（41）server start</a></li><li><a href="#42server_stop_823">（42）server stop</a></li><li><a href="#43server_suspend_832">（43）server suspend</a></li><li><a href="#44server_unlock_840">（44）server unlock</a></li><li><a href="#45server_unpause_848">（45）server unpause</a></li><li><a href="#46server_unrescue_857">（46）server unrescue</a></li><li><a href="#47server_unset_865">（47）server unset</a></li><li><a href="#48server_unshelve_873">（48）server unshelve</a></li></ul></ul></ul></div><p></p>
<h2><a id="_1"></a>本文章由公号【开发小鸽】发布！欢迎关注！！！</h2>
<br>
<p><strong>老规矩–妹妹镇楼：</strong></p>
<center>
<img src="https://img-blog.csdnimg.cn/20200721223424816.JPG" width="20%">
</center><h2><a id="1%09server_10"></a>1.	server相关命令测试</h2>
<h3><a id="1server_12"></a>（1）查看server相关命令</h3>
<pre><code class="prism language-cpp"><span class="token punctuation">[</span>root@controller neutron<span class="token punctuation">]</span># openstack server <span class="token operator">-</span>h
Command <span class="token string">"server"</span> matches<span class="token operator">:</span>
  server add fixed ip
  server add floating ip
  server add network
  server add port
  server add security group
  server add volume
  server backup create
  server create
  server <span class="token keyword">delete</span>
  server dump create
  server event list
  server event show
  server group create
  server group <span class="token keyword">delete</span>
  server group list
  server group show
  server image create
  server list
  server lock
  server migrate
  server pause
  server reboot
  server rebuild
  server remove fixed ip
  server remove floating ip
  server remove network
  server remove port
  server remove security group
  server remove volume
  server rescue
  server resize
  server resize confirm
  server resize revert
  server restore
  server resume
  server set
  server shelve
  server show
  server ssh
  server start
  server stop
  server suspend
  server unlock
  server unpause
  server unrescue
  server unset
  server unshelve
</code></pre>
<br>
<h3><a id="2server_add_fixed_ip_70"></a>（2）server add fixed ip</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;为server实例添加固定的IP，参数是network的ID：<br>
<img src="https://img-blog.csdnimg.cn/7b7fa28387bc49d1a21ee5dcd925c890.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="3server_add_floating_ip_79"></a>（3）server add floating ip</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;为server实例添加浮动的IP地址</p>
<p><img src="https://img-blog.csdnimg.cn/d54caad670a241bea893f66931e06aec.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="4server_add_network_89"></a>（4）server add network</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;为server实例添加network网络：<br>
<img src="https://img-blog.csdnimg.cn/8d0a2f868c9e4cc1bff31d0ec3182a79.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="5server_add_port_99"></a>（5）server add port</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;为server实例添加port端口<br>
<img src="https://img-blog.csdnimg.cn/b9029cb15da44209833f501caf5a8918.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="6server_add_security_group_108"></a>（6）server add security group</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;为server实例添加安全组：<br>
<img src="https://img-blog.csdnimg.cn/dde6a8a9410c45a78cfed3887e0120b1.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="7server_add_volume_119"></a>（7）server add volume</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;为server实例添加volume卷：<br>
<img src="https://img-blog.csdnimg.cn/3016029fc3644e0e95f0b790fbf7871c.png" alt="在这里插入图片描述"></p>
 <br>
<h3><a id="8server_backup_create_128"></a>（8）server backup create</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;Create a server backup image，创建实例的备份镜像，实际就是通过server实例创建一个镜像。<br>
<img src="https://img-blog.csdnimg.cn/b0e07c770ac14b12af3993265ef21560.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="9server_create_137"></a>（9）server create</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;创建一个server实例：<br>
<img src="https://img-blog.csdnimg.cn/c9cd10ef70db473db8ed46c2e9f21ecf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<br>
<h3><a id="10server_delete_145"></a>（10）server delete</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;删除一个server实例：<br>
<img src="https://img-blog.csdnimg.cn/62e7193d46ac47dc9349b5e37855b5b1.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="11__server_dump_create_155"></a>（11）  server dump create</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;创建一个dump文件：<br>
<img src="https://img-blog.csdnimg.cn/b3fe28c33f644a448a67979ffcd933b8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<br>
<h3><a id="12server_event_list_164"></a>（12）server event list</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;列出该server最近的event事件，即实例有哪些操作？<br>
<img src="https://img-blog.csdnimg.cn/b55988412da648399a94aed953790287.png" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/0db4151bb52548ed8a6bc026af4c146a.png" alt="在这里插入图片描述"></p>
 <br>
<h3><a id="13server_event_show_174"></a>（13）server event show</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;列出指定server实例的指定request请求的细节操作：<br>
<img src="https://img-blog.csdnimg.cn/02779f2a9db245daaa1181126056213d.png" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;当我们通过查询server的event事件后，获取到对应server的指定request请求ID后，查询该请求对应的详细信息：</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;比如说针对firstVM这个实例的start操作，我们可以查询一下该操作的详细信息：<br>
<img src="https://img-blog.csdnimg.cn/fbbe7a92fe1542faab1a3bfed53b440c.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="14server_group_create_189"></a>（14）server group create</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;创建一个server实例的群组，即多个server实例都放在一个群组中：<br>
<img src="https://img-blog.csdnimg.cn/64c07cbfeff840169fd9f01132cd44d5.png" alt="在这里插入图片描述"></p>
 <br>
<h3><a id="15server_group_delete_198"></a>（15）server group delete</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;删除一个server实例的群组：<br>
<img src="https://img-blog.csdnimg.cn/be3af576e9354a9ca609d8d01cf1f132.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="16server_group_list_207"></a>（16）server group list</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;列出所有的server实例的群组：<br>
<img src="https://img-blog.csdnimg.cn/fea16bbbbc5b4e4b8633df15c7c81c36.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="17server_group_show_216"></a>（17）server group show</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;展示出server实例群组的细节：<br>
<img src="https://img-blog.csdnimg.cn/f116f5189fb945ecbbfe3f5c05fd1da5.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="18server_image_create_226"></a>（18）server image create</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;通过一个server实例创建一个磁盘镜像：<br>
<img src="https://img-blog.csdnimg.cn/467fee39e48a490ab673d623b2bef5f9.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="19server_list_234"></a>（19）server list</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;列出所有的server实例：<br>
<img src="https://img-blog.csdnimg.cn/5ccadde8467547b78e979efd1aac496f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
 <br>
<h3><a id="20server_lock_243"></a>（20）server lock</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;将server实例给锁住，让非admin用户不会执行操作：<br>
<img src="https://img-blog.csdnimg.cn/5a315b934f8f4a869f9b2b1dda6a8b77.png" alt="在这里插入图片描述"></p>
 <br>
<h3><a id="21server_migrate_252"></a>（21）server migrate</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;迁移一个server实例到不同的计算节点中，也就是说选择另一个计算节点进行迁移：</p>
<p><img src="https://img-blog.csdnimg.cn/27c579650f9249a0953f8bf57bb2fab3.png" alt="在这里插入图片描述"></p>
<p>主要参数的解释如下所示：</p>
<p>–live-migration，动态迁移</p>
<p><img src="https://img-blog.csdnimg.cn/8d06807552ab4426abbc84672e17183a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>一开始通过如下的命令：</p>
<pre><code class="prism language-cpp">openstack server migrate <span class="token operator">--</span>live<span class="token operator">-</span>migration sixthVM
</code></pre>
<p>查看nova-api.log日志发现：</p>
<pre><code class="prism language-cpp"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">42.586</span> <span class="token number">2289</span> INFO nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi <span class="token punctuation">[</span>req<span class="token operator">-</span>de76dedd<span class="token operator">-</span>c998<span class="token operator">-</span><span class="token number">4325</span><span class="token operator">-</span><span class="token number">9546</span><span class="token operator">-</span><span class="token number">0034</span>cfab78e3 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> HTTP exception thrown<span class="token operator">:</span> 实例 sixthVM 没有找到。
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">42.589</span> <span class="token number">2289</span> INFO nova<span class="token punctuation">.</span>osapi_compute<span class="token punctuation">.</span>wsgi<span class="token punctuation">.</span>server <span class="token punctuation">[</span>req<span class="token operator">-</span>de76dedd<span class="token operator">-</span>c998<span class="token operator">-</span><span class="token number">4325</span><span class="token operator">-</span><span class="token number">9546</span><span class="token operator">-</span><span class="token number">0034</span>cfab78e3 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">112.146</span> <span class="token string">"GET /v2.1/servers/sixthVM HTTP/1.1"</span> status<span class="token operator">:</span> <span class="token number">404</span> len<span class="token operator">:</span> <span class="token number">517</span> time<span class="token operator">:</span> <span class="token number">0.2916870</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">42.730</span> <span class="token number">2289</span> INFO nova<span class="token punctuation">.</span>osapi_compute<span class="token punctuation">.</span>wsgi<span class="token punctuation">.</span>server <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">69</span>b8762b<span class="token operator">-</span>d341<span class="token operator">-</span><span class="token number">42</span>ae<span class="token operator">-</span>a19c<span class="token operator">-</span><span class="token number">8709e2</span>dbb3c8 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">112.146</span> <span class="token string">"GET /v2.1/servers?name=sixthVM HTTP/1.1"</span> status<span class="token operator">:</span> <span class="token number">200</span> len<span class="token operator">:</span> <span class="token number">701</span> time<span class="token operator">:</span> <span class="token number">0.1353440</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">43.186</span> <span class="token number">2289</span> INFO nova<span class="token punctuation">.</span>osapi_compute<span class="token punctuation">.</span>wsgi<span class="token punctuation">.</span>server <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">7e77</span>e0ef<span class="token operator">-</span><span class="token number">7</span>c2b<span class="token operator">-</span><span class="token number">4</span>b1b<span class="token operator">-</span>a17e<span class="token operator">-</span><span class="token number">475</span>ad37a9ec9 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">112.146</span> <span class="token string">"GET /v2.1/servers/ac91ed2c-6c0e-4865-afcf-2b1b9fcb5485 HTTP/1.1"</span> status<span class="token operator">:</span> <span class="token number">200</span> len<span class="token operator">:</span> <span class="token number">1959</span> time<span class="token operator">:</span> <span class="token number">0.4523001</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">46.180</span> <span class="token number">2289</span> INFO nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi <span class="token punctuation">[</span>req<span class="token operator">-</span>ba341f5a<span class="token operator">-</span><span class="token number">8855</span><span class="token operator">-</span><span class="token number">4</span>a67<span class="token operator">-</span><span class="token number">8</span>d69<span class="token operator">-</span><span class="token number">585</span>ae4dc2184 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> HTTP exception thrown<span class="token operator">:</span> 找不到有效主机，原因是 没有足够的主机可用。
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">46.181</span> <span class="token number">2289</span> INFO nova<span class="token punctuation">.</span>osapi_compute<span class="token punctuation">.</span>wsgi<span class="token punctuation">.</span>server <span class="token punctuation">[</span>req<span class="token operator">-</span>ba341f5a<span class="token operator">-</span><span class="token number">8855</span><span class="token operator">-</span><span class="token number">4</span>a67<span class="token operator">-</span><span class="token number">8</span>d69<span class="token operator">-</span><span class="token number">585</span>ae4dc2184 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">112.146</span> <span class="token string">"POST /v2.1/servers/ac91ed2c-6c0e-4865-afcf-2b1b9fcb5485/action HTTP/1.1"</span> status<span class="token operator">:</span> <span class="token number">400</span> len<span class="token operator">:</span> <span class="token number">600</span> time<span class="token operator">:</span> <span class="token number">2.9914739</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;发现到出现了error，找不到有效的主机，这是为什么呢？</p>
<p>继续查看nova-conductor.log日志：</p>
<pre><code class="prism language-cpp"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">46.096</span> <span class="token number">2403</span> WARNING nova<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>utils <span class="token punctuation">[</span>req<span class="token operator">-</span>ba341f5a<span class="token operator">-</span><span class="token number">8855</span><span class="token operator">-</span><span class="token number">4</span>a67<span class="token operator">-</span><span class="token number">8</span>d69<span class="token operator">-</span><span class="token number">585</span>ae4dc2184 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> Failed to compute_task_migrate_server<span class="token operator">:</span> 找不到有效主机，原因是 没有足够的主机可用。。
<span class="token function">Traceback</span> <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token operator">:</span>

  File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/server.py"</span><span class="token punctuation">,</span> line <span class="token number">235</span><span class="token punctuation">,</span> in inner
    <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>kwargs<span class="token punctuation">)</span>

  File <span class="token string">"/usr/lib/python2.7/site-packages/nova/scheduler/manager.py"</span><span class="token punctuation">,</span> line <span class="token number">214</span><span class="token punctuation">,</span> in select_destinations
    allocation_request_version<span class="token punctuation">,</span> return_alternates<span class="token punctuation">)</span>

  File <span class="token string">"/usr/lib/python2.7/site-packages/nova/scheduler/filter_scheduler.py"</span><span class="token punctuation">,</span> line <span class="token number">96</span><span class="token punctuation">,</span> in select_destinations
    allocation_request_version<span class="token punctuation">,</span> return_alternates<span class="token punctuation">)</span>

  File <span class="token string">"/usr/lib/python2.7/site-packages/nova/scheduler/filter_scheduler.py"</span><span class="token punctuation">,</span> line <span class="token number">265</span><span class="token punctuation">,</span> in _schedule
    claimed_instance_uuids<span class="token punctuation">)</span>

  File <span class="token string">"/usr/lib/python2.7/site-packages/nova/scheduler/filter_scheduler.py"</span><span class="token punctuation">,</span> line <span class="token number">302</span><span class="token punctuation">,</span> in _ensure_sufficient_hosts
    raise exception<span class="token punctuation">.</span><span class="token function">NoValidHost</span><span class="token punctuation">(</span>reason<span class="token operator">=</span>reason<span class="token punctuation">)</span>

NoValidHost<span class="token operator">:</span> \u627e\u4e0d\u5230\u6709\u6548\u4e3b\u673a\uff0c\u539f\u56e0\u662f \u6ca1\u6709\u8db3\u591f\u7684\u4e3b\u673a\u53ef\u7528\u3002\u3002
<span class="token operator">:</span> NoValidHost_Remote<span class="token operator">:</span> \u627e\u4e0d\u5230\u6709\u6548\u4e3b\u673a\uff0c\u539f\u56e0\u662f \u6ca1\u6709\u8db3\u591f\u7684\u4e3b\u673a\u53ef\u7528\u3002\u3002
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">46.098</span> <span class="token number">2403</span> WARNING nova<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>utils <span class="token punctuation">[</span>req<span class="token operator">-</span>ba341f5a<span class="token operator">-</span><span class="token number">8855</span><span class="token operator">-</span><span class="token number">4</span>a67<span class="token operator">-</span><span class="token number">8</span>d69<span class="token operator">-</span><span class="token number">585</span>ae4dc2184 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>instance<span class="token operator">:</span> ac91ed2c<span class="token operator">-</span><span class="token number">6</span>c0e<span class="token operator">-</span><span class="token number">4865</span><span class="token operator">-</span>afcf<span class="token operator">-</span><span class="token number">2</span>b1b9fcb5485<span class="token punctuation">]</span> Setting instance to ACTIVE state<span class="token punctuation">.</span><span class="token operator">:</span> NoValidHost_Remote<span class="token operator">:</span> \u627e\u4e0d\u5230\u6709\u6548\u4e3b\u673a\uff0c\u539f\u56e0\u662f \u6ca1\u6709\u8db3\u591f\u7684\u4e3b\u673a\u53ef\u7528\u3002\u3002
</code></pre>
<p>继续查看nova-scheduler.log日志：</p>
<p>可以看到，Host filter过滤器直接忽视了computer这个host；</p>
<pre><code class="prism language-cpp"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">45.100</span> <span class="token number">2690</span> INFO nova<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>host_manager <span class="token punctuation">[</span>req<span class="token operator">-</span>ba341f5a<span class="token operator">-</span><span class="token number">8855</span><span class="token operator">-</span><span class="token number">4</span>a67<span class="token operator">-</span><span class="token number">8</span>d69<span class="token operator">-</span><span class="token number">585</span>ae4dc2184 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> Host filter ignoring hosts<span class="token operator">:</span> computer
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">45.102</span> <span class="token number">2690</span> WARNING nova<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>filters<span class="token punctuation">.</span>compute_filter <span class="token punctuation">[</span>req<span class="token operator">-</span>ba341f5a<span class="token operator">-</span><span class="token number">8855</span><span class="token operator">-</span><span class="token number">4</span>a67<span class="token operator">-</span><span class="token number">8</span>d69<span class="token operator">-</span><span class="token number">585</span>ae4dc2184 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>localhost<span class="token punctuation">.</span>localdomain<span class="token punctuation">,</span> localhost<span class="token punctuation">.</span>localdomain<span class="token punctuation">)</span> ram<span class="token operator">:</span> <span class="token number">3258</span>MB disk<span class="token operator">:</span> <span class="token number">32768</span>MB io_ops<span class="token operator">:</span> <span class="token number">0</span> instances<span class="token operator">:</span> <span class="token number">0</span> has <span class="token operator">not</span> been heard from in a <span class="token keyword">while</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">45.102</span> <span class="token number">2690</span> INFO nova<span class="token punctuation">.</span>filters <span class="token punctuation">[</span>req<span class="token operator">-</span>ba341f5a<span class="token operator">-</span><span class="token number">8855</span><span class="token operator">-</span><span class="token number">4</span>a67<span class="token operator">-</span><span class="token number">8</span>d69<span class="token operator">-</span><span class="token number">585</span>ae4dc2184 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> Filter ComputeFilter returned <span class="token number">0</span> hosts
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">45.102</span> <span class="token number">2690</span> INFO nova<span class="token punctuation">.</span>filters <span class="token punctuation">[</span>req<span class="token operator">-</span>ba341f5a<span class="token operator">-</span><span class="token number">8855</span><span class="token operator">-</span><span class="token number">4</span>a67<span class="token operator">-</span><span class="token number">8</span>d69<span class="token operator">-</span><span class="token number">585</span>ae4dc2184 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> Filtering removed all hosts <span class="token keyword">for</span> the request with instance ID <span class="token string">'ac91ed2c-6c0e-4865-afcf-2b1b9fcb5485'</span><span class="token punctuation">.</span> Filter results<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'AvailabilityZoneFilter: (start: 1, end: 1)'</span><span class="token punctuation">,</span> <span class="token string">'ComputeFilter: (start: 1, end: 0)'</span><span class="token punctuation">]</span>
</code></pre>
<p>重新尝试命令，进行冷迁移：</p>
<pre><code class="prism language-cpp">openstack server migrate sixthVM
</code></pre>
<p>查看nova-api.log日志：</p>
<pre><code class="prism language-cpp"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">30.305</span> <span class="token number">2289</span> INFO nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">5</span>a10aa8f<span class="token operator">-</span>e1cf<span class="token operator">-</span><span class="token number">46</span>db<span class="token operator">-</span><span class="token number">8</span>a10<span class="token operator">-</span>a0626fe33d04 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> HTTP exception thrown<span class="token operator">:</span> 实例 sixthVM 没有找到。
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">30.307</span> <span class="token number">2289</span> INFO nova<span class="token punctuation">.</span>osapi_compute<span class="token punctuation">.</span>wsgi<span class="token punctuation">.</span>server <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">5</span>a10aa8f<span class="token operator">-</span>e1cf<span class="token operator">-</span><span class="token number">46</span>db<span class="token operator">-</span><span class="token number">8</span>a10<span class="token operator">-</span>a0626fe33d04 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">112.146</span> <span class="token string">"GET /v2.1/servers/sixthVM HTTP/1.1"</span> status<span class="token operator">:</span> <span class="token number">404</span> len<span class="token operator">:</span> <span class="token number">517</span> time<span class="token operator">:</span> <span class="token number">0.2010651</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">30.406</span> <span class="token number">2289</span> INFO nova<span class="token punctuation">.</span>osapi_compute<span class="token punctuation">.</span>wsgi<span class="token punctuation">.</span>server <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">812f</span>1dce<span class="token operator">-</span>e613<span class="token operator">-</span><span class="token number">4</span>b09<span class="token operator">-</span><span class="token number">8</span>aad<span class="token operator">-</span><span class="token number">5882881</span>ba4a9 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">112.146</span> <span class="token string">"GET /v2.1/servers?name=sixthVM HTTP/1.1"</span> status<span class="token operator">:</span> <span class="token number">200</span> len<span class="token operator">:</span> <span class="token number">701</span> time<span class="token operator">:</span> <span class="token number">0.0959730</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">30.712</span> <span class="token number">2289</span> INFO nova<span class="token punctuation">.</span>osapi_compute<span class="token punctuation">.</span>wsgi<span class="token punctuation">.</span>server <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">982</span>b31b4<span class="token operator">-</span><span class="token number">1</span>b66<span class="token operator">-</span><span class="token number">4731</span><span class="token operator">-</span><span class="token number">9499</span><span class="token operator">-</span><span class="token number">2</span>d2831d21061 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">112.146</span> <span class="token string">"GET /v2.1/servers/ac91ed2c-6c0e-4865-afcf-2b1b9fcb5485 HTTP/1.1"</span> status<span class="token operator">:</span> <span class="token number">200</span> len<span class="token operator">:</span> <span class="token number">1959</span> time<span class="token operator">:</span> <span class="token number">0.3029451</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">33.855</span> <span class="token number">2289</span> INFO nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">1</span>b899c05<span class="token operator">-</span><span class="token number">41</span>da<span class="token operator">-</span><span class="token number">4e75</span><span class="token operator">-</span>b808<span class="token operator">-</span><span class="token number">514</span>d351dbc79 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> HTTP exception thrown<span class="token operator">:</span> 找不到有效主机，原因是 冷迁移过程中发现无效主机。
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">33.856</span> <span class="token number">2289</span> INFO nova<span class="token punctuation">.</span>osapi_compute<span class="token punctuation">.</span>wsgi<span class="token punctuation">.</span>server <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">1</span>b899c05<span class="token operator">-</span><span class="token number">41</span>da<span class="token operator">-</span><span class="token number">4e75</span><span class="token operator">-</span>b808<span class="token operator">-</span><span class="token number">514</span>d351dbc79 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">112.146</span> <span class="token string">"POST /v2.1/servers/ac91ed2c-6c0e-4865-afcf-2b1b9fcb5485/action HTTP/1.1"</span> status<span class="token operator">:</span> <span class="token number">400</span> len<span class="token operator">:</span> <span class="token number">612</span> time<span class="token operator">:</span> <span class="token number">3.1414089</span>
</code></pre>
<p>查看nova-scheduler.log日志：<br>
&nbsp;  &nbsp;  &nbsp;  &nbsp;可以发现，问题主要在于filter过滤器直接将computer节点过滤掉了，因为我们在迁移虚机时，使用的过滤器应该第一个就是过滤掉之前已经调度过的computer节点：</p>
<pre><code class="prism language-cpp"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">33.148</span> <span class="token number">2692</span> INFO nova<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>host_manager <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">1</span>b899c05<span class="token operator">-</span><span class="token number">41</span>da<span class="token operator">-</span><span class="token number">4e75</span><span class="token operator">-</span>b808<span class="token operator">-</span><span class="token number">514</span>d351dbc79 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> Host filter ignoring hosts<span class="token operator">:</span> computer
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">33.154</span> <span class="token number">2692</span> WARNING nova<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>filters<span class="token punctuation">.</span>compute_filter <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">1</span>b899c05<span class="token operator">-</span><span class="token number">41</span>da<span class="token operator">-</span><span class="token number">4e75</span><span class="token operator">-</span>b808<span class="token operator">-</span><span class="token number">514</span>d351dbc79 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>localhost<span class="token punctuation">.</span>localdomain<span class="token punctuation">,</span> localhost<span class="token punctuation">.</span>localdomain<span class="token punctuation">)</span> ram<span class="token operator">:</span> <span class="token number">3258</span>MB disk<span class="token operator">:</span> <span class="token number">32768</span>MB io_ops<span class="token operator">:</span> <span class="token number">0</span> instances<span class="token operator">:</span> <span class="token number">0</span> has <span class="token operator">not</span> been heard from in a <span class="token keyword">while</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">33.155</span> <span class="token number">2692</span> INFO nova<span class="token punctuation">.</span>filters <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">1</span>b899c05<span class="token operator">-</span><span class="token number">41</span>da<span class="token operator">-</span><span class="token number">4e75</span><span class="token operator">-</span>b808<span class="token operator">-</span><span class="token number">514</span>d351dbc79 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> Filter ComputeFilter returned <span class="token number">0</span> hosts
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">33.155</span> <span class="token number">2692</span> INFO nova<span class="token punctuation">.</span>filters <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">1</span>b899c05<span class="token operator">-</span><span class="token number">41</span>da<span class="token operator">-</span><span class="token number">4e75</span><span class="token operator">-</span>b808<span class="token operator">-</span><span class="token number">514</span>d351dbc79 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> Filtering removed all hosts <span class="token keyword">for</span> the request with instance ID <span class="token string">'ac91ed2c-6c0e-4865-afcf-2b1b9fcb5485'</span><span class="token punctuation">.</span> Filter results<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'AvailabilityZoneFilter: (start: 1, end: 1)'</span><span class="token punctuation">,</span> <span class="token string">'ComputeFilter: (start: 1, end: 0)'</span><span class="token punctuation">]</span>
</code></pre>
<p>查看nova-conductor.log日志：</p>
<pre><code class="prism language-cpp"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">33.790</span> <span class="token number">2401</span> WARNING nova<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>utils <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">1</span>b899c05<span class="token operator">-</span><span class="token number">41</span>da<span class="token operator">-</span><span class="token number">4e75</span><span class="token operator">-</span>b808<span class="token operator">-</span><span class="token number">514</span>d351dbc79 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> Failed to compute_task_migrate_server<span class="token operator">:</span> 找不到有效主机，原因是 没有足够的主机可用。。
<span class="token function">Traceback</span> <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token operator">:</span>

  File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/server.py"</span><span class="token punctuation">,</span> line <span class="token number">235</span><span class="token punctuation">,</span> in inner
    <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>kwargs<span class="token punctuation">)</span>

  File <span class="token string">"/usr/lib/python2.7/site-packages/nova/scheduler/manager.py"</span><span class="token punctuation">,</span> line <span class="token number">214</span><span class="token punctuation">,</span> in select_destinations
    allocation_request_version<span class="token punctuation">,</span> return_alternates<span class="token punctuation">)</span>

  File <span class="token string">"/usr/lib/python2.7/site-packages/nova/scheduler/filter_scheduler.py"</span><span class="token punctuation">,</span> line <span class="token number">96</span><span class="token punctuation">,</span> in select_destinations
    allocation_request_version<span class="token punctuation">,</span> return_alternates<span class="token punctuation">)</span>

  File <span class="token string">"/usr/lib/python2.7/site-packages/nova/scheduler/filter_scheduler.py"</span><span class="token punctuation">,</span> line <span class="token number">265</span><span class="token punctuation">,</span> in _schedule
    claimed_instance_uuids<span class="token punctuation">)</span>

  File <span class="token string">"/usr/lib/python2.7/site-packages/nova/scheduler/filter_scheduler.py"</span><span class="token punctuation">,</span> line <span class="token number">302</span><span class="token punctuation">,</span> in _ensure_sufficient_hosts
    raise exception<span class="token punctuation">.</span><span class="token function">NoValidHost</span><span class="token punctuation">(</span>reason<span class="token operator">=</span>reason<span class="token punctuation">)</span>
#如下的都是<span class="token number">16</span>进制的字符，翻译过来就是无host可选：
<span class="token operator">:</span> NoValidHost_Remote<span class="token operator">:</span> \u627e\u4e0d\u5230\u6709\u6548\u4e3b\u673a\uff0c\u539f\u56e0\u662f \u6ca1\u6709\u8db3\u591f\u7684\u4e3b\u673a\u53ef\u7528\u3002\u3002
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">33.792</span> <span class="token number">2401</span> WARNING nova<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>utils <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">1</span>b899c05<span class="token operator">-</span><span class="token number">41</span>da<span class="token operator">-</span><span class="token number">4e75</span><span class="token operator">-</span>b808<span class="token operator">-</span><span class="token number">514</span>d351dbc79 <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>instance<span class="token operator">:</span> ac91ed2c<span class="token operator">-</span><span class="token number">6</span>c0e<span class="token operator">-</span><span class="token number">4865</span><span class="token operator">-</span>afcf<span class="token operator">-</span><span class="token number">2</span>b1b9fcb5485<span class="token punctuation">]</span> Setting instance to ACTIVE state<span class="token punctuation">.</span><span class="token operator">:</span> NoValidHost_Remote<span class="token operator">:</span> \u627e\u4e0d\u5230\u6709\u6548\u4e3b\u673a\uff0c\u539f\u56e0\u662f \u6ca1\u6709\u8db3\u591f\u7684\u4e3b\u673a\u53ef\u7528\u3002\u3002
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;查看nova.conf配置文件：/etc/nova/nova.conf，修改nova.conf配置文件，添加如下的driver驱动：</p>
<p><img src="https://img-blog.csdnimg.cn/698e49ad03ea40fab076421b5bcfea6b.png" alt="在这里插入图片描述"></p>
<pre><code class="prism language-cpp">scheduler_driver<span class="token operator">=</span>nova<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>filterscheduler<span class="token punctuation">.</span>FilterScheduler
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;配置可用的filter，默认所有的filter都可以使用:</p>
<p><img src="https://img-blog.csdnimg.cn/4c9ee4f367c646949eb5fca7564b64b3.png" alt="在这里插入图片描述"></p>
<pre><code class="prism language-cpp">scheduler_available_filters <span class="token operator">=</span> nova<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>filters<span class="token punctuation">.</span>all_filters
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;还可以指定真正使用的filter，会按照顺序依次地进行过滤：<br>
<img src="https://img-blog.csdnimg.cn/71f73938e189486499e81cb92bc7bcdf.png" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;将上面的设置去除掉RetryFilter，该filter的作用是去除掉之前调度过的节点；具体的每个filter的作用可以看看openstack的pdf文档：</p>
<pre><code class="prism language-cpp">scheduler_default_filters <span class="token operator">=</span> AvailabilityZoneFilter<span class="token punctuation">,</span> RamFilter<span class="token punctuation">,</span> DiskFilter<span class="token punctuation">,</span> ComputeFilter
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;重启Controller节点和Compute节点；</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;重新尝试热迁移虚拟机：</p>
<pre><code class="prism language-cpp">openstack server migrate <span class="token operator">--</span>live<span class="token operator">-</span>migration sixthVM
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/97cc8a767cd9467aaec6c4a76cb02cb5.png" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;出现报错，因此删除该server虚机：</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;重新将新的虚机启动，并且尝试冷迁移：</p>
<pre><code class="prism language-cpp">openstack server migrate fifthVM
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;同样是失败：<br>
<img src="https://img-blog.csdnimg.cn/40b49c91302344ba81b6df9d3afa8041.png" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;我们查看nova-api.log日志，可以看到一大堆的ERROR错误，<br>
<img src="https://img-blog.csdnimg.cn/d7fe22ac450b4f9788e0d0656e6aabba.png" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;大致的错误是消息超时，因此是neutron网络的原因，设置neutron.conf配置文件：<br>
&nbsp;  &nbsp;  &nbsp;  &nbsp;neutron在同步路由信息时，会从neutron-server获取所有router的信息，这个过程会比较长（130s左右，和网络资源的多少有关系），而 在/etc/neutron/neutron.conf中会有一个配置项“rpc_response_timeout”，它用来配置RPC的超时时间，默认为60s,所以导致超时异常.解决方法为设置rpc_response_timeout=180.</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;重新启动两个虚机；<br>
&nbsp;  &nbsp;  &nbsp;  &nbsp;重新将新的虚机启动，并且尝试冷迁移：</p>
<pre><code class="prism language-cpp">openstack server migrate fifthVM
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;依然失败：<br>
<img src="https://img-blog.csdnimg.cn/319c88bd02674dbe8cc8e196988e64dd.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="22server_pause_441"></a>（22）server pause</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;将server实例短时间暂停，保存在宿主机的内存中，等待resume操作后从内存中读出server实例的状态，然后继续运行server实例，它的状态是paused。<br>
<img src="https://img-blog.csdnimg.cn/87f7242fdf2347edabb0eb2f727eedca.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="23server_reboot_450"></a>（23）server reboot</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;soft reboot重启操作系统，整个过程server依然处于运行状态；<br>
&nbsp;  &nbsp;  &nbsp;  &nbsp;hard reboot重启server实例，相当于关机后再开机，<br>
<img src="https://img-blog.csdnimg.cn/241c6324b66d4ec0b9b9beac120e13fb.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="24server_rebuild_460"></a>（24）server rebuild</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;重建一个server实例，通过之前备份的snapshot镜像恢复当前的server实例：<br>
<img src="https://img-blog.csdnimg.cn/0513cd89896b4b7db8ac5050e7aa0102.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="25server_remove_fixed_ip_469"></a>（25）server remove fixed ip</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;移除server实例的固定IP地址：<br>
<img src="https://img-blog.csdnimg.cn/63016ba3640a40259a8aa57ab4c04feb.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="26server_remove_floating_ip_478"></a>（26）server remove floating ip</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;移除server实例的浮动IP地址：<br>
<img src="https://img-blog.csdnimg.cn/99e9dcf2629945d187cfda8ac0f3506f.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="27server_remove_network_486"></a>（27）server remove network</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;移除server实例的某个network的所有port：<br>
<img src="https://img-blog.csdnimg.cn/2978897767c248fd87b28f5d314ac3a6.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="28server_remove_port_495"></a>（28）server remove port</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;移除server实例的指定port：<br>
<img src="https://img-blog.csdnimg.cn/f638ebb9e3ac45118452eec3a9cfbd00.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="29server_remove_security_group_504"></a>（29）server remove security group</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;移除server实例的安全组：<br>
<img src="https://img-blog.csdnimg.cn/a7772a0e6b1f44088153988036f02786.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="30server_remove_volume_513"></a>（30）server remove volume</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;移除server实例的volume卷：<br>
<img src="https://img-blog.csdnimg.cn/2542ac1f572545baa234a258471e9ca3.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="31server_rescue_521"></a>（31）server rescue</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;考虑到操作系统故障，无法启动操作系统时，为了最大程度地挽救数据，我们需要使用一张启动盘将系统引导起来，然后再尝试恢复：<br>
<img src="https://img-blog.csdnimg.cn/d9a1d276eece4f3fa60cb4752a38bc04.png" alt="在这里插入图片描述"></p>
 <br>
<h3><a id="32server_resize_530"></a>（32）server resize</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;改变server实例的flavor大小，复制原有的server实例内容到新的server实例中，在resize之前借助nova-scheduler重新为server实例选择一个合适的计算节点，如果选择的节点不是同一个，就需要进行migrate；如果选择的是同一个计算节点，则就是resize操作：<br>
<img src="https://img-blog.csdnimg.cn/f3784e269b654e8081d183c87c9f91c1.png" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;因此创建一个新的flavor：</p>
<pre><code class="prism language-cpp">openstack flavor create <span class="token operator">--</span>id <span class="token number">4</span> <span class="token operator">--</span>ram <span class="token number">128</span> <span class="token operator">--</span>disk <span class="token number">1</span> <span class="token operator">--</span>vcpus <span class="token number">1</span> m1<span class="token punctuation">.</span>nano<span class="token punctuation">.</span><span class="token keyword">new</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;创建好之后，进行resize操作：</p>
<pre><code class="prism language-cpp">openstack server resize <span class="token operator">--</span>flavor m1<span class="token punctuation">.</span>nano<span class="token punctuation">.</span><span class="token keyword">new</span> fifthVM    
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;又是MQ的消息超时ERROR：</p>
<p>nova-api.log日志：</p>
<pre><code class="prism language-cpp"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi <span class="token punctuation">[</span>req<span class="token operator">-</span>adb018d8<span class="token operator">-</span>afb7<span class="token operator">-</span><span class="token number">4668</span><span class="token operator">-</span><span class="token number">869</span>c<span class="token operator">-</span><span class="token number">179</span>b90ea5dbf <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> Unexpected exception in API method<span class="token operator">:</span> MessagingTimeout<span class="token operator">:</span> Timed out waiting <span class="token keyword">for</span> a reply to message ID ddf0ff7c5a874baa963a728feaaf4c2a
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi <span class="token function">Traceback</span> <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token operator">:</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/api/openstack/wsgi.py"</span><span class="token punctuation">,</span> line <span class="token number">671</span><span class="token punctuation">,</span> in wrapped
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>kwargs<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/api/validation/__init__.py"</span><span class="token punctuation">,</span> line <span class="token number">110</span><span class="token punctuation">,</span> in wrapper
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>kwargs<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/servers.py"</span><span class="token punctuation">,</span> line <span class="token number">1045</span><span class="token punctuation">,</span> in _action_resize
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     self<span class="token punctuation">.</span><span class="token function">_resize</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> id<span class="token punctuation">,</span> flavor_ref<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>kwargs<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/api/openstack/compute/servers.py"</span><span class="token punctuation">,</span> line <span class="token number">964</span><span class="token punctuation">,</span> in _resize
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     self<span class="token punctuation">.</span>compute_api<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> flavor_id<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>kwargs<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/compute/api.py"</span><span class="token punctuation">,</span> line <span class="token number">225</span><span class="token punctuation">,</span> in inner
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     <span class="token keyword">return</span> <span class="token function">function</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>kwargs<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/compute/api.py"</span><span class="token punctuation">,</span> line <span class="token number">152</span><span class="token punctuation">,</span> in inner
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>kw<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/compute/api.py"</span><span class="token punctuation">,</span> line <span class="token number">215</span><span class="token punctuation">,</span> in wrapped
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     <span class="token keyword">return</span> <span class="token function">function</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>kwargs<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/compute/api.py"</span><span class="token punctuation">,</span> line <span class="token number">3796</span><span class="token punctuation">,</span> in resize
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     request_spec<span class="token operator">=</span>request_spec<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/conductor/api.py"</span><span class="token punctuation">,</span> line <span class="token number">96</span><span class="token punctuation">,</span> in resize_instance
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     request_spec<span class="token operator">=</span>request_spec<span class="token punctuation">,</span> host_list<span class="token operator">=</span>host_list<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/conductor/rpcapi.py"</span><span class="token punctuation">,</span> line <span class="token number">340</span><span class="token punctuation">,</span> in migrate_server
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     <span class="token keyword">return</span> cctxt<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">'migrate_server'</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>kw<span class="token punctuation">)</span>
#发送RPC远程请求，设置的两个timeout都是从nova<span class="token punctuation">.</span>conf中得到的
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/client.py"</span><span class="token punctuation">,</span> line <span class="token number">181</span><span class="token punctuation">,</span> in call
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     transport_options<span class="token operator">=</span>self<span class="token punctuation">.</span>transport_options<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/transport.py"</span><span class="token punctuation">,</span> line <span class="token number">129</span><span class="token punctuation">,</span> in _send
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     transport_options<span class="token operator">=</span>transport_options<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py"</span><span class="token punctuation">,</span> line <span class="token number">674</span><span class="token punctuation">,</span> in send
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     transport_options<span class="token operator">=</span>transport_options<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py"</span><span class="token punctuation">,</span> line <span class="token number">662</span><span class="token punctuation">,</span> in _send
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     call_monitor_timeout<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py"</span><span class="token punctuation">,</span> line <span class="token number">551</span><span class="token punctuation">,</span> in wait
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     message <span class="token operator">=</span> self<span class="token punctuation">.</span>waiters<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>msg_id<span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py"</span><span class="token punctuation">,</span> line <span class="token number">429</span><span class="token punctuation">,</span> in get
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi     <span class="token string">'to message ID %s'</span> <span class="token operator">%</span> msg_id<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi MessagingTimeout<span class="token operator">:</span> Timed out waiting <span class="token keyword">for</span> a reply to message ID ddf0ff7c5a874baa963a728feaaf4c2a
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.564</span> <span class="token number">2249</span> ERROR nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi 
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.566</span> <span class="token number">2249</span> INFO nova<span class="token punctuation">.</span>api<span class="token punctuation">.</span>openstack<span class="token punctuation">.</span>wsgi <span class="token punctuation">[</span>req<span class="token operator">-</span>adb018d8<span class="token operator">-</span>afb7<span class="token operator">-</span><span class="token number">4668</span><span class="token operator">-</span><span class="token number">869</span>c<span class="token operator">-</span><span class="token number">179</span>b90ea5dbf <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> HTTP exception thrown<span class="token operator">:</span> 发生意外 API 错误。请在 http<span class="token operator">:</span><span class="token comment">//bugs.launchpad.net/nova/ 处报告此错误，并且附上 Nova API 日志（如果可能）。</span>
<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'oslo_messaging.exceptions.MessagingTimeout'</span><span class="token operator">&gt;</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">47.567</span> <span class="token number">2249</span> INFO nova<span class="token punctuation">.</span>osapi_compute<span class="token punctuation">.</span>wsgi<span class="token punctuation">.</span>server <span class="token punctuation">[</span>req<span class="token operator">-</span>adb018d8<span class="token operator">-</span>afb7<span class="token operator">-</span><span class="token number">4668</span><span class="token operator">-</span><span class="token number">869</span>c<span class="token operator">-</span><span class="token number">179</span>b90ea5dbf <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">112.146</span> <span class="token string">"POST /v2.1/servers/a2c57cfb-7dd9-42b6-b1e2-454d07cfbe77/action HTTP/1.1"</span> status<span class="token operator">:</span> <span class="token number">500</span> len<span class="token operator">:</span> <span class="token number">755</span> time<span class="token operator">:</span> <span class="token number">61.0104420</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.621</span> <span class="token number">2249</span> INFO oslo_messaging<span class="token punctuation">.</span>_drivers<span class="token punctuation">.</span>amqpdriver <span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">]</span> No calling threads waiting <span class="token keyword">for</span> msg_id <span class="token operator">:</span> ddf0ff7c5a874baa963a728feaaf4c2a
</code></pre>
<p>nova-scheduler.log日志：<br>
无内容；</p>
<p>nova-conductor.log日志：</p>
<pre><code class="prism language-cpp"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">47.656</span> <span class="token number">2407</span> WARNING oslo_config<span class="token punctuation">.</span>cfg <span class="token punctuation">[</span>req<span class="token operator">-</span>adb018d8<span class="token operator">-</span>afb7<span class="token operator">-</span><span class="token number">4668</span><span class="token operator">-</span><span class="token number">869</span>c<span class="token operator">-</span><span class="token number">179</span>b90ea5dbf <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> Deprecated<span class="token operator">:</span> Option <span class="token string">"scheduler_default_filters"</span> from group <span class="token string">"DEFAULT"</span> is deprecated<span class="token punctuation">.</span> Use option <span class="token string">"enabled_filters"</span> from group <span class="token string">"filter_scheduler"</span><span class="token punctuation">.</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.517</span> <span class="token number">2407</span> WARNING nova<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>utils <span class="token punctuation">[</span>req<span class="token operator">-</span>adb018d8<span class="token operator">-</span>afb7<span class="token operator">-</span><span class="token number">4668</span><span class="token operator">-</span><span class="token number">869</span>c<span class="token operator">-</span><span class="token number">179</span>b90ea5dbf <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> Failed to compute_task_migrate_server<span class="token operator">:</span> Timed out waiting <span class="token keyword">for</span> a reply to message ID <span class="token number">187</span>df0b0f95a4e27919321830142d187<span class="token operator">:</span> MessagingTimeout<span class="token operator">:</span> Timed out waiting <span class="token keyword">for</span> a reply to message ID <span class="token number">187</span>df0b0f95a4e27919321830142d187
#实例设置为ACTIVE状态，消息超时
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.522</span> <span class="token number">2407</span> WARNING nova<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span>utils <span class="token punctuation">[</span>req<span class="token operator">-</span>adb018d8<span class="token operator">-</span>afb7<span class="token operator">-</span><span class="token number">4668</span><span class="token operator">-</span><span class="token number">869</span>c<span class="token operator">-</span><span class="token number">179</span>b90ea5dbf <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>instance<span class="token operator">:</span> a2c57cfb<span class="token operator">-</span><span class="token number">7</span>dd9<span class="token operator">-</span><span class="token number">42</span>b6<span class="token operator">-</span>b1e2<span class="token operator">-</span><span class="token number">454</span>d07cfbe77<span class="token punctuation">]</span> Setting instance to ACTIVE state<span class="token punctuation">.</span><span class="token operator">:</span> MessagingTimeout<span class="token operator">:</span> Timed out waiting <span class="token keyword">for</span> a reply to message ID <span class="token number">187</span>df0b0f95a4e27919321830142d187
#等待消息超时
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server <span class="token punctuation">[</span>req<span class="token operator">-</span>adb018d8<span class="token operator">-</span>afb7<span class="token operator">-</span><span class="token number">4668</span><span class="token operator">-</span><span class="token number">869</span>c<span class="token operator">-</span><span class="token number">179</span>b90ea5dbf <span class="token number">9942</span>eb4321644336a0c7383d9f1c2bed a7d812868cb74f1a978035530f55f1d0 <span class="token operator">-</span> <span class="token keyword">default</span> <span class="token keyword">default</span><span class="token punctuation">]</span> Exception during message handling<span class="token operator">:</span> MessagingTimeout<span class="token operator">:</span> Timed out waiting <span class="token keyword">for</span> a reply to message ID <span class="token number">187</span>df0b0f95a4e27919321830142d187
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server <span class="token function">Traceback</span> <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token operator">:</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/server.py"</span><span class="token punctuation">,</span> line <span class="token number">165</span><span class="token punctuation">,</span> in _process_incoming
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     res <span class="token operator">=</span> self<span class="token punctuation">.</span>dispatcher<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py"</span><span class="token punctuation">,</span> line <span class="token number">274</span><span class="token punctuation">,</span> in dispatch
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token function">_do_dispatch</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> method<span class="token punctuation">,</span> ctxt<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/dispatcher.py"</span><span class="token punctuation">,</span> line <span class="token number">194</span><span class="token punctuation">,</span> in _do_dispatch
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     result <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span>ctxt<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>new_args<span class="token punctuation">)</span>  
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/server.py"</span><span class="token punctuation">,</span> line <span class="token number">235</span><span class="token punctuation">,</span> in inner
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>kwargs<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/conductor/manager.py"</span><span class="token punctuation">,</span> line <span class="token number">95</span><span class="token punctuation">,</span> in wrapper
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>kwargs<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/compute/utils.py"</span><span class="token punctuation">,</span> line <span class="token number">1372</span><span class="token punctuation">,</span> in decorated_function
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     <span class="token keyword">return</span> <span class="token function">function</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>kwargs<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/conductor/manager.py"</span><span class="token punctuation">,</span> line <span class="token number">299</span><span class="token punctuation">,</span> in migrate_server
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     host_list<span class="token punctuation">)</span>
#从这一步开始出现exception
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/conductor/manager.py"</span><span class="token punctuation">,</span> line <span class="token number">381</span><span class="token punctuation">,</span> in _cold_migrate
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     updates<span class="token punctuation">,</span> ex<span class="token punctuation">,</span> request_spec<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py"</span><span class="token punctuation">,</span> line <span class="token number">220</span><span class="token punctuation">,</span> in __exit__
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     self<span class="token punctuation">.</span><span class="token function">force_reraise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py"</span><span class="token punctuation">,</span> line <span class="token number">196</span><span class="token punctuation">,</span> in force_reraise
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     six<span class="token punctuation">.</span><span class="token function">reraise</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>type_<span class="token punctuation">,</span> self<span class="token punctuation">.</span>value<span class="token punctuation">,</span> self<span class="token punctuation">.</span>tb<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/conductor/manager.py"</span><span class="token punctuation">,</span> line <span class="token number">350</span><span class="token punctuation">,</span> in _cold_migrate
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     task<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/conductor/tasks/base.py"</span><span class="token punctuation">,</span> line <span class="token number">27</span><span class="token punctuation">,</span> in wrap
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     self<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py"</span><span class="token punctuation">,</span> line <span class="token number">220</span><span class="token punctuation">,</span> in __exit__
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     self<span class="token punctuation">.</span><span class="token function">force_reraise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_utils/excutils.py"</span><span class="token punctuation">,</span> line <span class="token number">196</span><span class="token punctuation">,</span> in force_reraise
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     six<span class="token punctuation">.</span><span class="token function">reraise</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>type_<span class="token punctuation">,</span> self<span class="token punctuation">.</span>value<span class="token punctuation">,</span> self<span class="token punctuation">.</span>tb<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/conductor/tasks/base.py"</span><span class="token punctuation">,</span> line <span class="token number">24</span><span class="token punctuation">,</span> in wrap
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     <span class="token keyword">return</span> <span class="token function">original</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/conductor/tasks/base.py"</span><span class="token punctuation">,</span> line <span class="token number">42</span><span class="token punctuation">,</span> in execute
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token function">_execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/conductor/tasks/migrate.py"</span><span class="token punctuation">,</span> line <span class="token number">340</span><span class="token punctuation">,</span> in _execute
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     selection <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">_schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/conductor/tasks/migrate.py"</span><span class="token punctuation">,</span> line <span class="token number">376</span><span class="token punctuation">,</span> in _schedule
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     return_objects<span class="token operator">=</span>True<span class="token punctuation">,</span> return_alternates<span class="token operator">=</span>True<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/scheduler/client/query.py"</span><span class="token punctuation">,</span> line <span class="token number">42</span><span class="token punctuation">,</span> in select_destinations
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     instance_uuids<span class="token punctuation">,</span> return_objects<span class="token punctuation">,</span> return_alternates<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/nova/scheduler/rpcapi.py"</span><span class="token punctuation">,</span> line <span class="token number">160</span><span class="token punctuation">,</span> in select_destinations
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     <span class="token keyword">return</span> cctxt<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctxt<span class="token punctuation">,</span> <span class="token string">'select_destinations'</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">*</span>msg_args<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/rpc/client.py"</span><span class="token punctuation">,</span> line <span class="token number">181</span><span class="token punctuation">,</span> in call
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     transport_options<span class="token operator">=</span>self<span class="token punctuation">.</span>transport_options<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/transport.py"</span><span class="token punctuation">,</span> line <span class="token number">129</span><span class="token punctuation">,</span> in _send
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     transport_options<span class="token operator">=</span>transport_options<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py"</span><span class="token punctuation">,</span> line <span class="token number">674</span><span class="token punctuation">,</span> in send
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     transport_options<span class="token operator">=</span>transport_options<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py"</span><span class="token punctuation">,</span> line <span class="token number">662</span><span class="token punctuation">,</span> in _send
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     call_monitor_timeout<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py"</span><span class="token punctuation">,</span> line <span class="token number">551</span><span class="token punctuation">,</span> in wait
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     message <span class="token operator">=</span> self<span class="token punctuation">.</span>waiters<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>msg_id<span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server   File <span class="token string">"/usr/lib/python2.7/site-packages/oslo_messaging/_drivers/amqpdriver.py"</span><span class="token punctuation">,</span> line <span class="token number">429</span><span class="token punctuation">,</span> in get
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server     <span class="token string">'to message ID %s'</span> <span class="token operator">%</span> msg_id<span class="token punctuation">)</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server MessagingTimeout<span class="token operator">:</span> Timed out waiting <span class="token keyword">for</span> a reply to message ID <span class="token number">187</span>df0b0f95a4e27919321830142d187
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">50.616</span> <span class="token number">2407</span> ERROR oslo_messaging<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>server
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;查看到在调用rpc时，有这样的一行代码，其中的timeout参数采用的是nova.conf中的参数，因此我们尝试增大其中的两个timeout参数：</p>
<pre><code class="prism language-csharp"> cctxt <span class="token operator">=</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span>
            version<span class="token operator">=</span>version<span class="token punctuation">,</span> call_monitor_timeout<span class="token operator">=</span>CONF<span class="token punctuation">.</span>rpc_response_timeout<span class="token punctuation">,</span>
             timeout<span class="token operator">=</span>CONF<span class="token punctuation">.</span>long_rpc_timeout<span class="token punctuation">)</span>
</code></pre>
<p>因此在nova.conf配置中添加了两个参数：</p>
<pre><code class="prism language-cpp">rpc_response_timeout<span class="token operator">=</span><span class="token number">300</span>
long_rpc_timeout<span class="token operator">=</span><span class="token number">300</span>
</code></pre>
<p>重启Controller节点；</p>
<p>重新尝试resize操作：</p>
<pre><code class="prism language-cpp">openstack server resize <span class="token operator">--</span>flavor m1<span class="token punctuation">.</span>nano<span class="token punctuation">.</span><span class="token keyword">new</span> fourthVM
</code></pre>
<p>时间好像挺长的，这是为啥呢？查看nova-api.log日志中，该日志的内容一直在重复，感觉像是哪里出了问题。</p>
<p>查看Compute节点的nova-compute.log日志，可以看到内容也是一直在重复：</p>
<pre><code class="prism language-cpp"><span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">39</span><span class="token operator">:</span><span class="token number">40.963</span> <span class="token number">2129</span> INFO nova<span class="token punctuation">.</span>compute<span class="token punctuation">.</span>manager <span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>instance<span class="token operator">:</span> <span class="token number">91</span>cf5aa9<span class="token operator">-</span><span class="token number">4605</span><span class="token operator">-</span><span class="token number">4</span>c99<span class="token operator">-</span>bf0d<span class="token operator">-</span>f603c6c988df<span class="token punctuation">]</span> During sync_power_state the instance has a pending <span class="token function">task</span> <span class="token punctuation">(</span>resize_prep<span class="token punctuation">)</span><span class="token punctuation">.</span> Skip<span class="token punctuation">.</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">40</span><span class="token operator">:</span><span class="token number">42.936</span> <span class="token number">2129</span> INFO nova<span class="token punctuation">.</span>compute<span class="token punctuation">.</span>resource_tracker <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">52189</span>c54<span class="token operator">-</span><span class="token number">1223</span><span class="token operator">-</span><span class="token number">47</span>ae<span class="token operator">-</span>a960<span class="token operator">-</span><span class="token number">6</span>b76acd33a45 <span class="token operator">-</span> <span class="token operator">-</span> <span class="token operator">-</span> <span class="token operator">-</span> <span class="token operator">-</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>instance<span class="token operator">:</span> <span class="token number">91</span>cf5aa9<span class="token operator">-</span><span class="token number">4605</span><span class="token operator">-</span><span class="token number">4</span>c99<span class="token operator">-</span>bf0d<span class="token operator">-</span>f603c6c988df<span class="token punctuation">]</span> Updating resource usage from migration <span class="token number">348f</span>df7d<span class="token operator">-</span><span class="token number">00</span>b5<span class="token operator">-</span><span class="token number">46f</span>a<span class="token operator">-</span>ad7b<span class="token operator">-</span><span class="token number">704941</span>ebb736
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">40</span><span class="token operator">:</span><span class="token number">42.982</span> <span class="token number">2129</span> INFO nova<span class="token punctuation">.</span>compute<span class="token punctuation">.</span>resource_tracker <span class="token punctuation">[</span>req<span class="token operator">-</span><span class="token number">52189</span>c54<span class="token operator">-</span><span class="token number">1223</span><span class="token operator">-</span><span class="token number">47</span>ae<span class="token operator">-</span>a960<span class="token operator">-</span><span class="token number">6</span>b76acd33a45 <span class="token operator">-</span> <span class="token operator">-</span> <span class="token operator">-</span> <span class="token operator">-</span> <span class="token operator">-</span><span class="token punctuation">]</span> Instance ee0eb8cd<span class="token operator">-</span><span class="token number">560e-47</span>b6<span class="token operator">-</span><span class="token number">9</span>c32<span class="token operator">-</span>fec87a55ffb4 has allocations against <span class="token keyword">this</span> compute host but is <span class="token operator">not</span> found in the database<span class="token punctuation">.</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;看起来跟数据库好像有关系，最后一个日志中的意思是该实例在compute计算节点中是有分配的，但是在数据库中并没有发现，这可能是数据库的信息没有及时地更新。</p>
<p>错误：主机compute没有映射到任何单元<br>
&nbsp;  &nbsp;  &nbsp;  &nbsp;compute节点日志： <code>Instance xxx has allocations against this compute host but is not found in the database.</code><br>
&nbsp;  &nbsp;  &nbsp;  &nbsp;解决：添加计算节点到cell数据库：</p>
<pre><code class="prism language-cpp">su <span class="token operator">-</span>s <span class="token operator">/</span>bin<span class="token operator">/</span>sh <span class="token operator">-</span>c “nova<span class="token operator">-</span>manage cell_v2 discover_hosts <span class="token operator">--</span>verbose” nova
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;继续尝试在dashboard中进行resize操作，依然是无尽的重复，等待，虚机的状态一直保持在resize_prep状态，但是nova-api.log日志和nova-compute.log日志中的内容一直在重复，我们如果要停止该虚机的状态，则直接修改数据库即可，如下所示：</p>
<p>先查询数据库状态</p>
<pre><code class="prism language-cpp">use nova<span class="token punctuation">;</span>
select task_state<span class="token punctuation">,</span>vm_state<span class="token punctuation">,</span>power_state<span class="token punctuation">,</span>display_name<span class="token punctuation">,</span>deleted from instances where display_name<span class="token operator">=</span><span class="token string">"fourthVM"</span><span class="token punctuation">;</span>
修改 update instances set task_state <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> vm_state <span class="token operator">=</span> <span class="token string">'stopped'</span><span class="token punctuation">,</span> power_state <span class="token operator">=</span> <span class="token number">4</span> where display_name<span class="token operator">=</span><span class="token string">"fourthVM"</span> <span class="token operator">and</span> deleted<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;在此之后，fourthVM虚机的状态就会修改为shutdown。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;再次在nova.conf配置中添加了两个参数：</p>
<pre><code class="prism language-cpp">rpc_response_timeout<span class="token operator">=</span><span class="token number">300</span>
long_rpc_timeout<span class="token operator">=</span><span class="token number">300</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;并且将所有的scheduler配置全部注释掉，重启Controller节点和Compute节点：</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;再次尝试resize虚机：</p>
<pre><code class="prism language-cpp">openstack server resize <span class="token operator">--</span>flavor m1<span class="token punctuation">.</span>nano<span class="token punctuation">.</span><span class="token keyword">new</span> fourthVM
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;还是失败，因此决定下次再尝试resize和migrate操作！</p>
<br>
<h3><a id="33server_resize_confirm_746"></a>（33）server resize confirm</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;改变server实例大小，确认flavor大小修改完成同时释放旧的server：<br>
<img src="https://img-blog.csdnimg.cn/e029bdfa5c464a27b104fe92840e6535.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="34server_resize_revert_754"></a>（34）server resize revert</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;对server实例进行resize，反转server的新旧大小，即释放新的server，重启旧的server。<br>
<img src="https://img-blog.csdnimg.cn/759d2412e4bd4570aeb5245b93c97b00.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="35server_restore_763"></a>（35）server restore</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;修复某个server：</p>
<p><img src="https://img-blog.csdnimg.cn/bdea4723f7904b0bbaa3f0f388171558.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="36server_resume_772"></a>（36）server resume</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;中断后重新开始server实例，可以在pause或者suspend后恢复：<br>
<img src="https://img-blog.csdnimg.cn/e37f04a021624e8085d62635ce5d1615.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="37server_set_780"></a>（37）server set</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;设置server实例的属性，<br>
<img src="https://img-blog.csdnimg.cn/3bf85e0ac583410c945dcd9f23c5cae8.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="38server_shelve_788"></a>（38）server shelve</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;之前通过suspend操作后server实例处于shutdown状态，但是Hypervisor依然在宿主机上为其预留了资源，如果需要释放这些资源，则可以使用shelve来操作，该操作会将server实例作为image保存到glance中，然后在宿主机中删除该server实例：<br>
<img src="https://img-blog.csdnimg.cn/070c1a44e6ed4ca68253adff4232eb77.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="39server_show_797"></a>（39）server show</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;展示server实例的详细信息：</p>
<p><img src="https://img-blog.csdnimg.cn/4661a17adc064351b63ecf13bf37f12a.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="40server_ssh_806"></a>（40）server ssh</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;通过ssh的方式连接到server实例中，可以选择IPV4或是IPV6：<br>
<img src="https://img-blog.csdnimg.cn/e1b5e1e24f5c4e82bc386a183f53a6cd.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="41server_start_814"></a>（41）server start</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;启动serve实例：</p>
<p><img src="https://img-blog.csdnimg.cn/b29c559961154eb9b73b24d65a84d7fb.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="42server_stop_823"></a>（42）server stop</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;停止server实例：</p>
<p><img src="https://img-blog.csdnimg.cn/1971234b4aae46c6ac0a72ab2b054616.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="43server_suspend_832"></a>（43）server suspend</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;长时间暂停server实例，将server实例的状态保存在磁盘中，它的状态是shutdown ：<br>
<img src="https://img-blog.csdnimg.cn/5e12b38aa2544851a973293b8a42b32c.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="44server_unlock_840"></a>（44）server unlock</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;解锁server实例：<br>
<img src="https://img-blog.csdnimg.cn/283fcd21be6546688a326533e05bd4c7.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="45server_unpause_848"></a>（45）server unpause</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;恢复暂停的serve实例：<br>
<img src="https://img-blog.csdnimg.cn/16bc1e980a3a434faaa11c67d4ea49e9.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="46server_unrescue_857"></a>（46）server unrescue</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;让server实例从救援模式恢复：<br>
<img src="https://img-blog.csdnimg.cn/06617e249bd04b11ac30ac5d20446431.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="47server_unset_865"></a>（47）server unset</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;不设置server实例的相关属性：<br>
<img src="https://img-blog.csdnimg.cn/35ea8d7c9f8a450cbba8d5696262bf26.png" alt="在这里插入图片描述"></p>
<br>
<h3><a id="48server_unshelve_873"></a>（48）server unshelve</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;恢复被shelve掉的server实例，因为之前的shevle操作保存了之前server实例的镜像文件，因此unshelve操作其实就是通过该镜像重启一个新的server实例：</p>
<p><img src="https://img-blog.csdnimg.cn/d0e3c2d943cc4780897964473473038b.png" alt="在这里插入图片描述"></p>
</div>
</body>

</html>
