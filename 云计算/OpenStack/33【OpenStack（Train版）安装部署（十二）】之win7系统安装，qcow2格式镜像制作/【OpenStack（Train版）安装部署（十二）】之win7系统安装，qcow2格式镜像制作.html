<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>【OpenStack（Train版）安装部署（十二）】之win7系统安装，qcow2格式镜像制作</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><p></p><div class="toc"><h3>文章目录</h3><ul><ul><li><a href="#_1">本文章由公号【开发小鸽】发布！欢迎关注！！！</a></li><li><a href="#1win7qcow2_10">1.win7系统qcow2格式镜像制作</a></li><ul><li><a href="#1_11">（1）概述</a></li><li><a href="#2ISOqcow2_19">（2）-失败-安装ISO镜像到qcow2磁盘。</a></li><li><a href="#3vnc_viewer_101">（3）vnc viewer连接虚机</a></li><li><a href="#4Centos_142">（4）Centos安装图形化界面</a></li><li><a href="#5virtmanager_157">（5）virt-manager创建虚拟机</a></li><li><a href="#6virtinstall_343">（6）virt-install命令创建虚拟机</a></li><li><a href="#7qcow2_428">（7）qcow2格式镜像空间压缩</a></li><li><a href="#8virtinstall_439">（8）virt-install命令参数说明</a></li><li><a href="#9virsh_636">（9）virsh命令</a></li></ul></ul></ul></div><p></p>
<h2><a id="_1"></a>本文章由公号【开发小鸽】发布！欢迎关注！！！</h2>
<br>
<p><strong>老规矩–妹妹镇楼：</strong></p>
<center>
<img src="https://img-blog.csdnimg.cn/20200721223424816.JPG" width="20%">
</center><h2><a id="1win7qcow2_10"></a>1.win7系统qcow2格式镜像制作</h2>
<h3><a id="1_11"></a>（1）概述</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;qcow2 格式的镜像获取可以直接网络下载相应系统镜像，也可以自己制作。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;使用qemu通过ISO镜像创建虚拟机，创建qcow2格式磁盘安装虚拟机系统，安装完成后该qcow2格式磁盘就是一个虚拟机的镜像文件。<br>
<br></p>
<h3><a id="2ISOqcow2_19"></a>（2）-失败-安装ISO镜像到qcow2磁盘。</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;安装virt-win驱动。无法直接使用OpenStack安装Windows的ISO镜像到卷的一大部分原因是windows无法直接使用virtio格式硬盘，需要驱动。</p>
<pre><code class="prism language-cpp">yum <span class="token operator">-</span>y install wget
wget https<span class="token operator">:</span><span class="token comment">//fedorapeople.org/groups/virt/virtio-win/virtio-win.repo -O /etc/yum.repos.d/virtio-win.repo</span>
yum <span class="token operator">-</span>y install virtio<span class="token operator">-</span>win
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;安装完成后RPM包内容</p>
<pre><code class="prism language-cpp"><span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>virtio<span class="token operator">-</span>win<span class="token comment">/*.iso:   ISO镜像，包含所有驱动。
/usr/share/virtio-win/*.vfd:   用于Windows XP下的VFD软驱镜像
/usr/share/virtio-win/drivers: 从VFD软驱镜像中提取的文件
/usr/share/guest-agent/*.msi:  QEMU Guest Agent 32bit 和 64bit 安装包
</span></code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;准备镜像到文件夹/image</p>
<p><img src="https://img-blog.csdnimg.cn/7486068e0e7e48e8af13c9dc292332c2.png" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;创建qcow2格式磁盘，指定大小100G。磁盘文件放在/vhost 目录。</p>
<pre><code class="prism language-cpp">mkdir <span class="token operator">/</span>vhost
qemu<span class="token operator">-</span>img  create <span class="token operator">-</span>f qcow2 <span class="token operator">/</span>vhost<span class="token operator">/</span>win7_xshell<span class="token punctuation">.</span>qcow2 <span class="token number">100</span>G
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;查看磁盘信息：</p>
<pre><code class="prism language-cpp">qemu<span class="token operator">-</span>img info <span class="token operator">/</span>vhost<span class="token operator">/</span>win7_xshell<span class="token punctuation">.</span>qcow2
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;修改两个目录的权限</p>
<pre><code class="prism language-cpp">chmod <span class="token number">777</span> <span class="token operator">/</span>image<span class="token comment">/*
chmod 777 /vhost/*
</span></code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;开始将iso格式的镜像安装到刚刚创建的qcow2格式的文件中：</p>
<pre><code class="prism language-cpp">virt<span class="token operator">-</span>install <span class="token operator">--</span>name<span class="token operator">=</span>win7_xshell <span class="token operator">--</span>ram<span class="token operator">=</span><span class="token number">2048</span> <span class="token operator">--</span>vcpus<span class="token operator">=</span><span class="token number">2</span> <span class="token operator">--</span>network network<span class="token operator">=</span><span class="token keyword">default</span><span class="token punctuation">,</span>model<span class="token operator">=</span>virtio <span class="token operator">--</span>cdrom<span class="token operator">=</span><span class="token operator">/</span>image<span class="token operator">/</span>cn_windows_7_ultimate_with_sp1_x64_dvd_u_677408<span class="token punctuation">.</span>iso <span class="token operator">--</span>boot menu<span class="token operator">=</span>on <span class="token operator">--</span>disk<span class="token operator">=</span><span class="token operator">/</span>vhost<span class="token operator">/</span>win7_xshell<span class="token punctuation">.</span>qcow2<span class="token punctuation">,</span>format<span class="token operator">=</span>qcow2<span class="token punctuation">,</span>bus<span class="token operator">=</span>virtio <span class="token operator">--</span>disk<span class="token operator">=</span><span class="token operator">/</span>image<span class="token operator">/</span>virtio<span class="token operator">-</span>win<span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">.</span><span class="token number">171.</span>iso<span class="token punctuation">,</span>device<span class="token operator">=</span>cdrom <span class="token operator">--</span>graphics vnc<span class="token punctuation">,</span>listen<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">0.0</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">5901</span> <span class="token operator">--</span>os<span class="token operator">-</span>type<span class="token operator">=</span>windows <span class="token operator">--</span>os<span class="token operator">-</span>variant<span class="token operator">=</span>win7 <span class="token operator">--</span>force
</code></pre>
<p>注意问题：</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;cdrom和disk都不要设置在/root中，防止没有权限访问；</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;有两个disk设置，一个是qcow2格式的虚拟机地址，一个是virtio-win驱动的地址；</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;os-variant需要设置为系统的版本win7；</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;通过vnc viewer连接虚拟机vnc 进行Win7操作系统的安装。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;需一个可远程连接到CentOS7服务器主机的图形化系统，如windows mac安装vnc viewer软件，连接到服务器的相应端口对虚拟机系统进行安装设置。</p>
<pre><code class="prism language-cpp">sudo virt<span class="token operator">-</span>install <span class="token operator">--</span>connect qemu<span class="token operator">:</span><span class="token comment">///system -n win7 \
--vcpus=1 -r 2048 \
--disk path=/home/win7.img,format=qcow2,device=disk,size=64,bus=virtio,cache=none \
--disk path=/home/cn_windows_7_ultimate_with_sp1_x64_dvd_u_677408.iso,device=cdrom,perms=rw  \
--vnc --vnclisten=0.0.0.0  \
--os-type windows --os-variant=win7 \
--accelerate --network=default,model=virtio  \
--disk path=/home/virtio-win-0.1.110.iso,device=cdrom,perms=rw \
--disk=/home/virtio-win-0.1.110_amd64.vfd,device=floppy</span>
</code></pre>
<br>
<h3><a id="3vnc_viewer_101"></a>（3）vnc viewer连接虚机</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;在PC机上安装了vnc viewer后用来连接vnc server，vnc server部署在Controller节点之上，我们在之前通过virt-install安装了qcow2虚机，端口设置为5901，因此我们直接通过vnc viewer连接vnc server即可。</p>
<p><img src="https://img-blog.csdnimg.cn/8f91117c42db4eb38f9cdd08dff78fd9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_12,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;开启连接后可能会出现以下的情况：<br>
<img src="https://img-blog.csdnimg.cn/3975e614e9e64678aef04cfc544315ac.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;如果确定ISO文件没有错误。那可能是boot引导选错了ISO，需手动选择。右键点击VNC Viewer，然后选择send Ctrl+Alt+Del。然后重新连接。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;还是引导错误。再次Ctrl+Alt+Del，这一次不会退出该界面，手速快点，在看到Press ESC for boot menu是按下键盘esc。然后会让手动选择引导盘。（手速慢或者错过了还是会自动引导失败进入该界面，可以重复Ctrl+Alt+Del）<br>
<img src="https://img-blog.csdnimg.cn/cf99f28d7f6d4f08bf6b16aa882a79c2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;选择3或者4。进入引导安装界面（应该是选择4没错的，错了再次Ctrl+Alt+De）</p>
<p><img src="https://img-blog.csdnimg.cn/1e448909490e424591d803f4ef33dff7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/5dbf43c1e7034ebe84f832b97b412956.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;正常完成系统安装步骤直到出现硬盘驱动无法加载界面</p>
<p><img src="https://img-blog.csdnimg.cn/3e2b3661dc134ac29e1f0b0fdc54ecfe.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;选择加载驱动程序 自动扫描，然后选择win7的驱动。<br>
<img src="https://img-blog.csdnimg.cn/2cfd95cc249644dea09036f31867d830.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;等待驱动安装完成后即可选择磁盘，但是每一次都会卡在安装驱动上面，这是为什么呢？如下所示：<br>
<img src="https://img-blog.csdnimg.cn/7945f27046724f2a964249cc261361f4.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_13,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>
<br></p>
<h3><a id="4Centos_142"></a>（4）Centos安装图形化界面</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;感觉像是virt-install的参数设置问题导致的，因此尝试通过virt-manager图形化界面直接创建虚机；</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;因此尝试为centos安装图形化界面：</p>
<pre><code class="prism language-cpp">yum groupinstall <span class="token operator">-</span>y <span class="token string">"GNOME Desktop"</span>
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;输入 init 5 进入图形化桌面</p>
<br>
<h3><a id="5virtmanager_157"></a>（5）virt-manager创建虚拟机</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;查看是否支持了虚拟化：cat /proc/cpuinfo | grep -E ‘vmx|svm’（可跳过），由于是新创建的虚拟机，因此需要在VMware中开启虚拟化；</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;查看是否kvm的驱动已经加载：</p>
<pre><code class="prism language-cpp">lsmod <span class="token operator">|</span> grep kvm（可跳过）
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;如果没有加载kvm驱动，利用命令加载驱动</p>
<pre><code class="prism language-cpp">modprobe <span class="token operator">-</span>a kvm
modprobe <span class="token operator">-</span>a kvm_intel
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;安装qemu-kvm</p>
<pre><code class="prism language-cpp">yum install <span class="token operator">-</span>y qemu<span class="token operator">-</span>kvm
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;安装libvirt:</p>
<pre><code class="prism language-cpp">yum install <span class="token operator">-</span>y libvirt
</code></pre>
<pre><code class="prism language-cpp">service libvirtd restart
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;验证libvirt是否正常启动</p>
<pre><code class="prism language-cpp">virsh version
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;安装virt-manager工具</p>
<pre><code class="prism language-cpp">yum install <span class="token operator">-</span>y virt<span class="token operator">-</span>manager
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;关闭xshell，重新连接，输入命令：virt-manager，就可以自动弹出kvm管理软件</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;通过virt-manager图形化界面来安装一个Win7虚拟机</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;首先将image镜像转移到当前的虚拟机中，包括win7.iso镜像以及virtio镜像；<br>
<img src="https://img-blog.csdnimg.cn/2aac92717bda4b978c50a859e6d56f60.png" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;首先创建qcow2格式磁盘，指定虚拟磁盘大小100G。磁盘文件放在/vhost 目录。</p>
<pre><code class="prism language-cpp">mkdir <span class="token operator">/</span>vhost
qemu<span class="token operator">-</span>img  create <span class="token operator">-</span>f qcow2 <span class="token operator">/</span>vhost<span class="token operator">/</span>win7_xshell<span class="token punctuation">.</span>qcow2 <span class="token number">100</span>G
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;查看磁盘信息：</p>
<pre><code class="prism language-cpp">qemu<span class="token operator">-</span>img info <span class="token operator">/</span>vhost<span class="token operator">/</span>win7_xshell<span class="token punctuation">.</span>qcow2
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;可以看到，当前的实际磁盘大小是196k，虚拟磁盘大小是100G：<br>
<img src="https://img-blog.csdnimg.cn/4155bfe9ec674bde986c82528a771a35.png" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;修改两个目录的权限</p>
<pre><code class="prism language-cpp">chmod <span class="token number">777</span> <span class="token operator">/</span>image<span class="token comment">/*
chmod 777 /vhost/*
</span></code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;开始通过virt-manager图形化界面创建虚拟机：</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;从已存在的磁盘镜像中导入，这里对应的就是刚刚创建的 /vhost/win7_xshell.qcow2<br>
<img src="https://img-blog.csdnimg.cn/697687012be04d7ead2352da7fceb8f7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;选择qcow2格式磁盘，以及设置Win7<br>
<img src="https://img-blog.csdnimg.cn/7b53569d3a45409584a596faa32ec067.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_14,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;设置核心和内存大小，注意这里尽量设置的大一些，因为Win7的最低配置都是2GB内存，2核心，同时还要注意要在一个尽量大的宿主机中进行，之前的一直卡在安装virtio驱动这个过程中就是因为内存，核心设置不够导致的卡顿，因此新建了一个8G，6核心，100G的新的Centos虚拟机用来创建虚拟机。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;设置需要自定义配置<br>
<img src="https://img-blog.csdnimg.cn/54dec381a8024281a16dde1306f0abd6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_13,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;设置qcow2格式的磁盘的总线类型是virtio：</p>
<p><img src="https://img-blog.csdnimg.cn/2dd63ed92707461281dfccfe855762fa.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;设置虚拟网络设备类型是virtio：<br>
<img src="https://img-blog.csdnimg.cn/372fbf15100b459ba32f3868fa2faa05.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;设置通过vnc连接虚拟机：</p>
<p><img src="https://img-blog.csdnimg.cn/dd50ba4512db4ef8b379dd7e2c73d767.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;设置显卡类型是cirrus：<br>
<img src="https://img-blog.csdnimg.cn/bc4e58adaf2d4eca919798cfcde07fcd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;添加virtio_amd64.vfd为软盘格式到虚拟机中：<br>
<img src="https://img-blog.csdnimg.cn/a9807dbed09c4977bba6ed0f099655f3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;添加win7.iso镜像为cdrom格式到虚拟机中：</p>
<p><img src="https://img-blog.csdnimg.cn/140342b24fb148cf90ce40564e70127a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;设置系统启动顺序为cdrom磁盘：</p>
<p><img src="https://img-blog.csdnimg.cn/94cf8df5f04a41e78775a3d558aa1d79.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;开始安装win7系统：<br>
<img src="https://img-blog.csdnimg.cn/1d69eece2701400c8713c44ac66ac2c7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;接下来就是非常快速地进入win7安装界面中，哭了，之前安装win7系统非常缓慢的原因就是宿主机的容量太小了，谨记啊，谨记啊！！！</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;到了需要加载驱动的时候，需要选择之前挂载的virtio软盘：<br>
<img src="https://img-blog.csdnimg.cn/fb707ec86eb14cc6b142a40e069109ce.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;选择win7的amd64格式的驱动：</p>
<p><img src="https://img-blog.csdnimg.cn/45c3558d63924cb0a25a9aa4bc6bbbc7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;这次并没有卡顿，而是直接安装驱动完毕，然后显示了磁盘，该磁盘就是我们创建的qcow2格式磁盘</p>
<p><img src="https://img-blog.csdnimg.cn/0d92e0ade5c24b2584d66a121d8dccba.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;后面的就是安装Win7系统的过程了<br>
<img src="https://img-blog.csdnimg.cn/b1de405ef5c14d76a77ea9f4d3c3e3cc.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;Win7系统成功地安装</p>
<p><img src="https://img-blog.csdnimg.cn/a2d9ccf32f9543c18472d2b9bd012c40.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_13,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;在该虚拟机中创建一个文档标明是图形化界面作为区分。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;之后设置网卡驱动，此时没有网络驱动，需要手动安装。点击开始图标右边的服务管理器<br>
<img src="https://img-blog.csdnimg.cn/0a0e4d3599c84051b9ffbda0a5161db7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;选择以太网控制器 更新驱动程序 手动查找驱动<br>
<img src="https://img-blog.csdnimg.cn/d157085815e24dfda6d562bbc1ac2dca.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;选择win7下的驱动进行安装<br>
<img src="https://img-blog.csdnimg.cn/c13f93377a07421baaab0863f0953fa9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;安装完成virtio-win的网卡驱动后，使用的virtio网络，查看当前虚拟机的网络情况：<br>
<img src="https://img-blog.csdnimg.cn/1094714815644a018e0fb10ad7345f23.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_13,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;可以看到，IP地址设置为了192.168.122.142，同时尝试与宿主机ping，发现也可以ping通。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;查看当前的qcow2格式Win7虚拟机镜像信息：<br>
&nbsp;  &nbsp;  &nbsp;  &nbsp;可以看到，当前的qcow2格式镜像大小为8.3G，原始的iso镜像大小为3.4G<br>
<img src="https://img-blog.csdnimg.cn/49719773b627436680d468b439f498ca.png" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;注：只有配置了KVM虚拟机，libvirt就会生成一个与操作系统对应的xml文件，其记录了kvm虚拟机的状态。路径如下：/etc/libvirt/qemu<br>
<img src="https://img-blog.csdnimg.cn/a5c4f96f3370421db8710f05bc9782fc.png" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;注：此文件只能通过“virsh edit”命令修改</p>
<br>
<h3><a id="6virtinstall_343"></a>（6）virt-install命令创建虚拟机</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;创建qcow2格式磁盘，指定大小100G。磁盘文件放在/vhost 目录。</p>
<pre><code class="prism language-cpp">mkdir <span class="token operator">/</span>vhost
qemu<span class="token operator">-</span>img  create <span class="token operator">-</span>f qcow2 <span class="token operator">/</span>vhost<span class="token operator">/</span>win7_virt<span class="token punctuation">.</span>qcow2 <span class="token number">100</span>G
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;查看该qcow2格式磁盘的信息：<br>
<img src="https://img-blog.csdnimg.cn/8a4d5064da934474b89b65e9f62dd028.png" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;开始将iso格式的镜像安装到刚刚创建的qcow2格式的文件中：</p>
<pre><code class="prism language-cpp">virt<span class="token operator">-</span>install <span class="token operator">--</span>name<span class="token operator">=</span>win7_virt <span class="token operator">--</span>vcpus<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">--</span>ram <span class="token number">4096</span> <span class="token operator">--</span>disk path<span class="token operator">=</span><span class="token operator">/</span>vhost<span class="token operator">/</span>win7_virt<span class="token punctuation">.</span>qcow2<span class="token punctuation">,</span>format<span class="token operator">=</span>qcow2<span class="token punctuation">,</span>device<span class="token operator">=</span>disk<span class="token punctuation">,</span>bus<span class="token operator">=</span>virtio <span class="token operator">--</span>disk path<span class="token operator">=</span><span class="token operator">/</span>image<span class="token operator">/</span>cn_windows_7_ultimate_with_sp1_x64_dvd_u_677408<span class="token punctuation">.</span>iso<span class="token punctuation">,</span>device<span class="token operator">=</span>cdrom<span class="token punctuation">,</span>perms<span class="token operator">=</span>rw <span class="token operator">--</span>vnc <span class="token operator">--</span>vnclisten<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">0.0</span>  <span class="token operator">--</span>os<span class="token operator">-</span>type windows <span class="token operator">--</span>os<span class="token operator">-</span>variant<span class="token operator">=</span>win7 <span class="token operator">--</span>accelerate <span class="token operator">--</span>network<span class="token operator">=</span><span class="token keyword">default</span><span class="token punctuation">,</span>model<span class="token operator">=</span>virtio  <span class="token operator">--</span>disk<span class="token operator">=</span><span class="token operator">/</span>image<span class="token operator">/</span>virtio<span class="token operator">-</span>win<span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">.</span><span class="token number">171</span>_amd64<span class="token punctuation">.</span>vfd<span class="token punctuation">,</span>device<span class="token operator">=</span>floppy <span class="token operator">--</span>video cirrus <span class="token operator">--</span>boot<span class="token operator">=</span>cdrom <span class="token operator">--</span>check path_in_use<span class="token operator">=</span>off
</code></pre>
<p>注意问题：<br>
&nbsp;  &nbsp;  &nbsp;  &nbsp;cdrom和disk都不要设置在/root中，防止没有权限访问；</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;有两个disk设置，一个是qcow2格式的虚拟机地址，一个是virtio-win驱动的地址；</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;os-variant需要设置为系统的版本win7；</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;完全按照图形化界面安装win7系统的方式添加参数；</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;使用同一个iso镜像，设置不检查iso镜像路径；</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;通过vnc viewer连接虚拟机vnc 进行Win7操作系统的安装。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;需一个可远程连接到CentOS7服务器主机的图形化系统，如windows mac安装vnc viewer软件，连接到服务器的相应端口对虚拟机系统进行安装设置。</p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;要想连接虚拟机就需要执行一条命令来查看刚才新建虚拟机的端口信息</p>
<pre><code class="prism language-cpp"><span class="token punctuation">[</span>root@compute <span class="token operator">~</span><span class="token punctuation">]</span># netstat <span class="token operator">-</span>lntup <span class="token operator">|</span>grep kvm
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/41b1a1439bf4409f835da868a296aed4.png" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;但是即使设置了正确的IP地址，也无法连接上，考虑可能是防火墙的问题，因此将防火墙的开机自启动关闭了：</p>
<pre><code class="prism language-cpp">systemctl stop firewalld
systemctl disable firewalld
</code></pre>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;再次通过vnc server连接就可以连接到虚拟机上了：<br>
<img src="https://img-blog.csdnimg.cn/1d3e46437baa42ea9731dca9f9771c22.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_13,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;接下来就是正常的win7系统的安装过程；<br>
<img src="https://img-blog.csdnimg.cn/56898f40bd16436b8ef38b076433d288.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_13,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;可以看到这是一个全新的win7虚拟机，并没有因为是通过同一个win7的iso镜像创建的就有所相同，说明iso镜像是公用的，而通过该iso镜像创建的qcow2格式镜像是互不相同的。在该虚拟机中再次创建创建一个下文档标识该虚拟机是xshell命令创建的：<br>
<img src="https://img-blog.csdnimg.cn/dc35495f4ec0472b9235a93bd935a2a1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_13,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;之后设置网卡驱动，此时没有网络驱动，需要手动安装。点击开始图标右边的服务管理器<br>
<img src="https://img-blog.csdnimg.cn/85fe8243c1ce4ca89bc43bd4c5be777a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;选择以太网控制器 更新驱动程序 手动查找驱动<br>
<img src="https://img-blog.csdnimg.cn/735dfca3c6f346f2bcb8cd48b85f240a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;选择win7下的驱动进行安装<br>
<img src="https://img-blog.csdnimg.cn/20c6a52e24514a4396e62720d645059b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_19,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;安装完成virtio-win的网卡驱动后，使用的virtio网络，查看当前虚拟机的网络情况：</p>
<p><img src="https://img-blog.csdnimg.cn/a8906de28a2a4183a927be29886fc8db.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5byA5Y-R5bCP6bi9,size_13,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;可以看到，IP地址设置为了192.168.122.142，同时尝试与宿主机ping，发现也可以ping通。</p>
<br>
<h3><a id="7qcow2_428"></a>（7）qcow2格式镜像空间压缩</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;直接通过下面的方式即可压缩镜像空间：</p>
<pre><code class="prism language-cpp">qemu<span class="token operator">-</span>img convert <span class="token operator">-</span>O qcow2 win7<span class="token punctuation">.</span>qcow2 win7_new<span class="token punctuation">.</span>qcow2
</code></pre>
<br>
<h3><a id="8virtinstall_439"></a>（8）virt-install命令参数说明</h3>
<p>virt-install 常用参数说明（新版本的写法）</p>
<pre><code class="prism language-cpp"><span class="token operator">--</span>name      指定虚拟机名称  
<span class="token operator">--</span>ram       虚拟机内存大小，以 MB 为单位  
<span class="token operator">--</span>vcpus     分配CPU核心数，最大与实体机CPU核心数相同  
<span class="token operator">--</span>network   虚拟机网络配置  
<span class="token operator">--</span>os<span class="token operator">-</span>type	系统的类型如 linux windows
<span class="token operator">--</span>os<span class="token operator">-</span>variant	操作系统类型，更详细的表述。可以用osinfo<span class="token operator">-</span>query os命令列出可选系统
</code></pre>
<pre><code class="prism language-cpp"><span class="token operator">--</span>disk 指定虚拟机的磁盘存储位置 ，size，初始磁盘大小，以 GB 为单位。  

<span class="token operator">--</span>location 指定安装介质路径，如光盘镜像的文件路径。  
<span class="token operator">--</span>graphics 图形化显示配置，全新安装虚拟机过程中可能会有很多交互操作，比如设置语言，初始化 root 密码等等。graphics 选项的作用就是配置图形化的交互方式，可以使用 vnc（一种远程桌面软件）进行链接。如果使用命令行的方式安装，这里要设置为 none，但要通过 <span class="token operator">--</span>extra<span class="token operator">-</span>args 选项指定终端信息，这样才能将安装过程中的交互信息输出到当前控制台。  
<span class="token operator">--</span>extra<span class="token operator">-</span>args 根据不同的安装方式设置不同的额外选项  
</code></pre>
<pre><code class="prism language-cpp"><span class="token operator">--</span>cdrom 待安装的ISO镜像 也可使用<span class="token operator">--</span>location
<span class="token operator">--</span>boot 引导方式。设置menu<span class="token operator">=</span>on 表示可手动选择引导盘。设置<span class="token operator">--</span>boot<span class="token operator">=</span>cdrom，引导直接通过cdrom启动。
<span class="token operator">--</span>graphics 设置vnc的端口。linsten<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">0.0</span> 允许除本机外主机连接。
</code></pre>
<pre><code class="prism language-cpp">optional arguments<span class="token operator">:</span>
  <span class="token operator">-</span>h<span class="token punctuation">,</span> <span class="token operator">--</span>help            show <span class="token keyword">this</span> help message <span class="token operator">and</span> exit
  <span class="token operator">--</span>version             show program<span class="token number">'</span>s version number <span class="token operator">and</span> exit
  <span class="token operator">--</span>connect URI         通过 libvirt URI 连接到虚拟机管理程序
</code></pre>
<pre><code class="prism language-cpp">通用选项<span class="token operator">:</span>
  <span class="token operator">-</span>n NAME<span class="token punctuation">,</span> <span class="token operator">--</span>name NAME  客户机实例名称
  <span class="token operator">--</span>memory MEMORY       Configure guest memory allocation<span class="token punctuation">.</span> Ex<span class="token operator">:</span>
                        <span class="token operator">--</span>memory <span class="token number">1024</span> <span class="token punctuation">(</span>in MiB<span class="token punctuation">)</span>
                        <span class="token operator">--</span>memory <span class="token number">512</span><span class="token punctuation">,</span>maxmemory<span class="token operator">=</span><span class="token number">1024</span>
                        <span class="token operator">--</span>memory <span class="token number">512</span><span class="token punctuation">,</span>maxmemory<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">,</span>hotplugmemorymax<span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">,</span>hotplugmemoryslots<span class="token operator">=</span><span class="token number">2</span>
  <span class="token operator">--</span>vcpus VCPUS         Number of vcpus to configure <span class="token keyword">for</span> your guest<span class="token punctuation">.</span> Ex<span class="token operator">:</span>
                        <span class="token operator">--</span>vcpus <span class="token number">5</span>
                        <span class="token operator">--</span>vcpus <span class="token number">5</span><span class="token punctuation">,</span>maxvcpus<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>cpuset<span class="token operator">=</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span>
                        <span class="token operator">--</span>vcpus sockets<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>cores<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>threads<span class="token operator">=</span><span class="token number">2</span>
  <span class="token operator">--</span>cpu CPU             CPU model <span class="token operator">and</span> features<span class="token punctuation">.</span> Ex<span class="token operator">:</span>
                        <span class="token operator">--</span>cpu coreduo<span class="token punctuation">,</span><span class="token operator">+</span>x2apic
                        <span class="token operator">--</span>cpu host<span class="token operator">-</span>passthrough
                        <span class="token operator">--</span>cpu host
  <span class="token operator">--</span>metadata METADATA   配置客户机元数据。例如：
                        <span class="token operator">--</span>metadata name<span class="token operator">=</span>foo<span class="token punctuation">,</span>title<span class="token operator">=</span><span class="token string">"My pretty title"</span><span class="token punctuation">,</span>uuid<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                        <span class="token operator">--</span>metadata description<span class="token operator">=</span><span class="token string">"My nice long description"</span>
</code></pre>
<pre><code class="prism language-cpp">安装方法选项<span class="token operator">:</span>
  <span class="token operator">--</span>cdrom CDROM         光驱安装介质
  <span class="token operator">-</span>l LOCATION<span class="token punctuation">,</span> <span class="token operator">--</span>location LOCATION
                        安装源 <span class="token punctuation">(</span>例如：nfs<span class="token operator">:</span>host<span class="token operator">:</span><span class="token operator">/</span>path<span class="token punctuation">,</span> http<span class="token operator">:</span><span class="token comment">//host/path,</span>
                        ftp<span class="token operator">:</span><span class="token comment">//host/path)</span>
  <span class="token operator">--</span>pxe                 使用 PXE 协议从网络引导
  <span class="token operator">--</span>import              在已有的磁盘镜像中构建客户机
  <span class="token operator">--</span>livecd              将光驱介质视为 Live CD
  <span class="token operator">-</span>x EXTRA_ARGS<span class="token punctuation">,</span> <span class="token operator">--</span>extra<span class="token operator">-</span>args EXTRA_ARGS
                        将附加参数添加到由 <span class="token operator">--</span>location
                        引导的内核中
  <span class="token operator">--</span>initrd<span class="token operator">-</span>inject INITRD_INJECT
                        添加指定文件到由 <span class="token operator">--</span>location 指定的 initrd
                        根中
  <span class="token operator">--</span>os<span class="token operator">-</span>variant DISTRO_VARIANT
                        在客户机上安装的操作系统，例如：'fedor
                        a18<span class="token string">'、'</span>rhel6<span class="token string">'、'</span>winxp<span class="token number">'</span> 等。
  <span class="token operator">--</span>boot BOOT           配置客户机引导设置。例如：
                        <span class="token operator">--</span>boot hd<span class="token punctuation">,</span>cdrom<span class="token punctuation">,</span>menu<span class="token operator">=</span>on
                        <span class="token operator">--</span>boot init<span class="token operator">=</span><span class="token operator">/</span>sbin<span class="token operator">/</span><span class="token function">init</span> <span class="token punctuation">(</span>针对容器<span class="token punctuation">)</span>
  <span class="token operator">--</span>idmap IDMAP         为 LXC 容器启用用户名称空间。例如：
                        <span class="token operator">--</span>idmap uid_start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>uid_target<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>uid_count<span class="token operator">=</span><span class="token number">10</span>
</code></pre>
<pre><code class="prism language-cpp">设备选项<span class="token operator">:</span>
  <span class="token operator">--</span>disk DISK           指定存储的各种选项。例如：
                        <span class="token operator">--</span>disk size<span class="token operator">=</span><span class="token number">10</span> <span class="token punctuation">(</span>在默认位置创建 <span class="token number">10</span>GiB 镜像<span class="token punctuation">)</span>
                        <span class="token operator">--</span>disk <span class="token operator">/</span>my<span class="token operator">/</span>existing<span class="token operator">/</span>disk<span class="token punctuation">,</span>cache<span class="token operator">=</span>none
                        <span class="token operator">--</span>disk device<span class="token operator">=</span>cdrom<span class="token punctuation">,</span>bus<span class="token operator">=</span>scsi
                        <span class="token operator">--</span>disk<span class="token operator">=</span><span class="token operator">?</span>
  <span class="token operator">-</span>w NETWORK<span class="token punctuation">,</span> <span class="token operator">--</span>network NETWORK
                        配置客户机网络接口。例如：
                        <span class="token operator">--</span>network bridge<span class="token operator">=</span>mybr0
                        <span class="token operator">--</span>network network<span class="token operator">=</span>my_libvirt_virtual_net
                        <span class="token operator">--</span>network network<span class="token operator">=</span>mynet<span class="token punctuation">,</span>model<span class="token operator">=</span>virtio<span class="token punctuation">,</span>mac<span class="token operator">=</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">11.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                        <span class="token operator">--</span>network none
                        <span class="token operator">--</span>network help
  <span class="token operator">--</span>graphics GRAPHICS   配置客户机显示设置。例如：
                        <span class="token operator">--</span>graphics vnc
                        <span class="token operator">--</span>graphics spice<span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">5901</span><span class="token punctuation">,</span>tlsport<span class="token operator">=</span><span class="token number">5902</span>
                        <span class="token operator">--</span>graphics none
                        <span class="token operator">--</span>graphics vnc<span class="token punctuation">,</span>password<span class="token operator">=</span>foobar<span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">5910</span><span class="token punctuation">,</span>keymap<span class="token operator">=</span>ja
  <span class="token operator">--</span>controller CONTROLLER
                        配置客户机控制器设备。例如：
                        <span class="token operator">--</span>controller type<span class="token operator">=</span>usb<span class="token punctuation">,</span>model<span class="token operator">=</span>ich9<span class="token operator">-</span>ehci1
  <span class="token operator">--</span>input INPUT         配置客户机输入设备。例如：
                        <span class="token operator">--</span>input tablet
                        <span class="token operator">--</span>input keyboard<span class="token punctuation">,</span>bus<span class="token operator">=</span>usb
  <span class="token operator">--</span>serial SERIAL       配置客户机串口设备
  <span class="token operator">--</span>parallel PARALLEL   配置客户机并口设备
  <span class="token operator">--</span>channel CHANNEL     配置客户机通信通道
  <span class="token operator">--</span>console CONSOLE     配置文本控制台连接主机与客户机
  <span class="token operator">--</span>hostdev HOSTDEV     配置物理 USB<span class="token operator">/</span>PCI 等主机设备与客户机共享
  <span class="token operator">--</span>filesystem FILESYSTEM
                        传递主机目录到客户机。例如：
                        <span class="token operator">--</span>filesystem <span class="token operator">/</span>my<span class="token operator">/</span>source<span class="token operator">/</span>dir<span class="token punctuation">,</span><span class="token operator">/</span>dir<span class="token operator">/</span>in<span class="token operator">/</span>guest
                        <span class="token operator">--</span>filesystem template_name<span class="token punctuation">,</span><span class="token operator">/</span><span class="token punctuation">,</span>type<span class="token operator">=</span><span class="token keyword">template</span>
  <span class="token operator">--</span>sound <span class="token punctuation">[</span>SOUND<span class="token punctuation">]</span>       配置客户机声音设备仿真
  <span class="token operator">--</span>watchdog WATCHDOG   配置客户机 watchdog 设备
  <span class="token operator">--</span>video VIDEO         配置客户机视频硬件。
  <span class="token operator">--</span>smartcard SMARTCARD
                        配置客户机智能卡设备。例如：
                        <span class="token operator">--</span>smartcard mode<span class="token operator">=</span>passthrough
  <span class="token operator">--</span>redirdev REDIRDEV   配置客户机重定向设备。例如：
                        <span class="token operator">--</span>redirdev usb<span class="token punctuation">,</span>type<span class="token operator">=</span>tcp<span class="token punctuation">,</span>server<span class="token operator">=</span><span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">1.1</span><span class="token operator">:</span><span class="token number">4000</span>
  <span class="token operator">--</span>memballoon MEMBALLOON
                        配置客户机 memballoon 设备。例如：
                        <span class="token operator">--</span>memballoon model<span class="token operator">=</span>virtio
  <span class="token operator">--</span>tpm TPM             配置客户机 TPM 设备。例如：
                        <span class="token operator">--</span>tpm <span class="token operator">/</span>dev<span class="token operator">/</span>tpm
  <span class="token operator">--</span>rng RNG             Configure a guest RNG device<span class="token punctuation">.</span> Ex<span class="token operator">:</span>
                        <span class="token operator">--</span>rng <span class="token operator">/</span>dev<span class="token operator">/</span>urandom
  <span class="token operator">--</span>panic PANIC         配置客户机 panic 设备。例如：
                        <span class="token operator">--</span>panic <span class="token keyword">default</span>
  <span class="token operator">--</span>memdev MEMDEV       Configure a guest memory device<span class="token punctuation">.</span> Ex<span class="token operator">:</span>
                        <span class="token operator">--</span>memdev dimm<span class="token punctuation">,</span>target_size<span class="token operator">=</span><span class="token number">1024</span>
</code></pre>
<pre><code class="prism language-cpp">客户机配置选项<span class="token operator">:</span>
  <span class="token operator">--</span>security SECURITY   设置域安全驱动配置。
  <span class="token operator">--</span>cputune CPUTUNE     Tune CPU parameters <span class="token keyword">for</span> the domain process<span class="token punctuation">.</span>
  <span class="token operator">--</span>numatune NUMATUNE   为域进程调整 NUMA 策略。
  <span class="token operator">--</span>memtune MEMTUNE     为域进程调整内存策略。
  <span class="token operator">--</span>blkiotune BLKIOTUNE
                        为域进程调整 blkio 策略。
  <span class="token operator">--</span>memorybacking MEMORYBACKING
                        为域进程设置内存后备策略。例如：
                        <span class="token operator">--</span>memorybacking hugepages<span class="token operator">=</span>on
  <span class="token operator">--</span>features FEATURES   设置域 <span class="token operator">&lt;</span>features<span class="token operator">&gt;</span> XML。例如：
                        <span class="token operator">--</span>features acpi<span class="token operator">=</span>off
                        <span class="token operator">--</span>features apic<span class="token operator">=</span>on<span class="token punctuation">,</span>eoi<span class="token operator">=</span>on
  <span class="token operator">--</span>clock CLOCK         设置域 <span class="token operator">&lt;</span>clock<span class="token operator">&gt;</span> XML。例如：
                        <span class="token operator">--</span>clock offset<span class="token operator">=</span>localtime<span class="token punctuation">,</span>rtc_tickpolicy<span class="token operator">=</span>catchup
  <span class="token operator">--</span>pm PM               配置 VM 电源管理功能
  <span class="token operator">--</span>events EVENTS       配置 VM 生命周期管理策略
  <span class="token operator">--</span>resource RESOURCE   配置 VM 资源分区<span class="token punctuation">(</span>cgroups<span class="token punctuation">)</span>
  <span class="token operator">--</span>sysinfo SYSINFO     Configure SMBIOS System Information<span class="token punctuation">.</span> Ex<span class="token operator">:</span>
                        <span class="token operator">--</span>sysinfo emulate
                        <span class="token operator">--</span>sysinfo host
                        <span class="token operator">--</span>sysinfo bios_vendor<span class="token operator">=</span>Vendor_Inc<span class="token punctuation">.</span><span class="token punctuation">,</span>bios_version<span class="token operator">=</span><span class="token number">1.2</span><span class="token punctuation">.</span><span class="token number">3</span><span class="token operator">-</span>abc<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                        <span class="token operator">--</span>sysinfo system_manufacturer<span class="token operator">=</span>System_Corp<span class="token punctuation">.</span><span class="token punctuation">,</span>system_product<span class="token operator">=</span>Computer<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                        <span class="token operator">--</span>sysinfo baseBoard_manufacturer<span class="token operator">=</span>Baseboard_Corp<span class="token punctuation">.</span><span class="token punctuation">,</span>baseBoard_product<span class="token operator">=</span>Motherboard<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token operator">--</span>qemu<span class="token operator">-</span>commandline QEMU_COMMANDLINE
                        Pass arguments directly to the qemu emulator<span class="token punctuation">.</span> Ex<span class="token operator">:</span>
                        <span class="token operator">--</span>qemu<span class="token operator">-</span>commandline<span class="token operator">=</span><span class="token string">'-display gtk,gl=on'</span>
                        <span class="token operator">--</span>qemu<span class="token operator">-</span>commandline env<span class="token operator">=</span>DISPLAY<span class="token operator">=</span><span class="token operator">:</span><span class="token number">0.1</span>
</code></pre>
<pre><code class="prism language-cpp">虚拟化平台选项<span class="token operator">:</span>
  <span class="token operator">-</span>v<span class="token punctuation">,</span> <span class="token operator">--</span>hvm             这个客户机应该是一个全虚拟化客户机
  <span class="token operator">-</span>p<span class="token punctuation">,</span> <span class="token operator">--</span>paravirt        这个客户机应该是一个半虚拟化客户机
  <span class="token operator">--</span>container           这个客户机应该是一个容器客户机
  <span class="token operator">--</span>virt<span class="token operator">-</span>type HV_TYPE   要使用的管理程序名称 <span class="token punctuation">(</span>kvm<span class="token punctuation">,</span> qemu<span class="token punctuation">,</span> xen<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
  <span class="token operator">--</span>arch ARCH           模拟 CPU 架构
  <span class="token operator">--</span>machine MACHINE     机器类型为仿真类型
</code></pre>
<pre><code class="prism language-cpp">其它选项<span class="token operator">:</span>
  <span class="token operator">--</span>autostart           主机启动时自动启动域。
  <span class="token operator">--</span>transient           Create a transient domain<span class="token punctuation">.</span>
  <span class="token operator">--</span>wait WAIT           请等待数分钟以便完成安装。
  <span class="token operator">--</span>noautoconsole       不要自动尝试连接到客户端控制台
  <span class="token operator">--</span>noreboot            安装完成后不启动客户机。
  <span class="token operator">--</span>print<span class="token operator">-</span>xml <span class="token punctuation">[</span>XMLONLY<span class="token punctuation">]</span>
                        打印生成的 XML 域，而不是创建客户机。
  <span class="token operator">--</span>dry<span class="token operator">-</span>run             运行安装程序，但不创建设备或定义客户
                        机。
  <span class="token operator">--</span>check CHECK         启用或禁用验证检查。例如：
                        <span class="token operator">--</span>check path_in_use<span class="token operator">=</span>off
                        <span class="token operator">--</span>check all<span class="token operator">=</span>off
  <span class="token operator">-</span>q<span class="token punctuation">,</span> <span class="token operator">--</span>quiet           抑制非错误输出
  <span class="token operator">-</span>d<span class="token punctuation">,</span> <span class="token operator">--</span>debug           输入故障排除信息
</code></pre>
<br>
<h3><a id="9virsh_636"></a>（9）virsh命令</h3>
<p>&nbsp;  &nbsp;  &nbsp;  &nbsp;上面通过virt-install来创建了虚机，可以通过virsh命令来查看：</p>
<p>virsh常用命令：</p>
<pre><code class="prism language-cpp">virsh start x                   启动名字为x的非活动虚拟机  
virsh list   <span class="token operator">--</span>all                 列出虚拟机  
virsh create x<span class="token punctuation">.</span>xml           创建虚拟机（创建后，虚拟机立即执行，成为活动主机）  
virsh suspend x              暂停虚拟机  
virsh resume x               启动暂停的虚拟机  
virsh shutdown x           正常关闭虚拟机  
virsh destroy x               强制关闭虚拟机  
virsh undefine x          删除虚拟机  
virsh dominfo x                 显示虚拟机的基本信息  
virsh domname <span class="token number">2</span>               显示id号为<span class="token number">2</span>的虚拟机名  
virsh domid x                    显示虚拟机id号  
virsh domuuid x                 显示虚拟机的uuid  
virsh domstate x                显示虚拟机的当前状态  
virsh dumpxml x                 显示虚拟机的当前配置文件（可能和定义虚拟机时的配置不同，因为当虚拟机启动时，需要给虚拟机 分配id号、uuid、vnc端口号等等）  
virsh setmem x <span class="token number">512000</span>       给不活动虚拟机设置内存大小  
virsh edit x                        编辑配置文件（一般是在刚定义完虚拟机之后） 
</code></pre>
</div>
</body>

</html>
